import{t as et,c as tt,a as d,s as c,g as u,b as y,d as U,p as _,e as st,S as k,f as L,h as z,u as A,i as l,j as g,l as M,k as j,m as f,n as T,o as v,q as p,v as C,r as fe,w as it,x as X,y as ve,C as at}from"./CglMtoSz.js";import{c as W,a as F,o as x,n as I,b as O,s as S,d as te,u as Oe,e as ee,l as we,r as Se,_ as ue,f as rt}from"./KFa1jneB.js";import{$ as nt,a as me,b as se,c as K,d as ot,e as ut,f as Be,g as lt}from"./BFKdG0ZG.js";const P=nt(),B=me(P);function zt(s){return s.split(":")}function ge(s,e="UTC"){return new Date(s.year,s.month-1,s.day).getDay()}function ct(s){const e=s%10,t=s%100;return e===1&&t!==11?"st":e===2&&t!==12?"nd":e===3&&t!==13?"rd":"th"}function dt(s,e){return s.month===e.month&&s.year===e.year}function le(s,e,t=!1){if(e<0||e>6)throw new Error("Target weekday must be between 0 (Sunday) and 6 (Saturday)");const a=s.toDate(P).getDay();if(a===e&&t)return s;let r=e-a;return r<=0&&(r+=7),s.add({days:r})}function ht(s,e,t,i){try{if(t===5)return ft(s,e,i);const a=me(P).set({year:s,month:e,day:1}),r=ge(a,P);let n=i-r;n<0&&(n+=7),n+=(t-1)*7;const o=a.add({days:n});return o.month===e?o:null}catch{return null}}function ft(s,e,t){try{const i=e===12?1:e+1,a=e===12?s+1:s,n=me(P).set({year:a,month:i,day:1}).subtract({days:1});for(let o=0;o<7;o++){const h=n.subtract({days:o});if(ge(h,P)===t)return h}return null}catch{return null}}function jt(s){if(!s)return null;try{if(s&&typeof s=="object"&&"year"in s&&"month"in s&&"day"in s)return s;if(typeof s=="string"){const e=new Date(s);return isNaN(e.getTime())?null:new se(e.getFullYear(),e.getMonth()+1,e.getDate())}if(s instanceof Date)return isNaN(s.getTime())?null:new se(s.getFullYear(),s.getMonth()+1,s.getDate());if(typeof s=="number"&&!isNaN(s)){const e=new Date(s);return isNaN(e.getTime())?null:new se(e.getFullYear(),e.getMonth()+1,e.getDate())}return null}catch{return null}}function Wt(s,e="UTC"){return s.toDate(e)}function qt(...s){return et(tt(s))}const be=/([0-9]+)/gm;function Yt(s,e){const t=s.split(be).filter(Boolean),i=e.split(be).filter(Boolean);for(;t.length&&i.length;){const a=t.shift(),r=i.shift(),n=Number.parseInt(a,10),o=Number.parseInt(r,10),h=[n,o].sort();if(Number.isNaN(h[0])){if(a>r)return 1;if(r>a)return-1;continue}if(Number.isNaN(h[1]))return Number.isNaN(n)?-1:1;if(n>o)return 1;if(o>n)return-1}return t.length-i.length}const mt=(s,e)=>{const t=[],i=[];return s.forEach(a=>{e(a)?i.push(a):t.push(a)}),s.splice(0,s.length,...t),[t,i]};function q(s,e){const{length:t}=s;if(t!==e.length)return!1;for(let i=t;i--!==0;)if(!Y(s[i],e[i]))return!1;return!0}function gt(s,e){if(s.byteLength!==e.byteLength)return!1;const t=new DataView(s.buffer),i=new DataView(e.buffer);let a=s.byteLength;for(;a--;)if(t.getUint8(a)!==i.getUint8(a))return!1;return!0}function yt(s,e){if(s.size!==e.size)return!1;for(const t of s.entries())if(!e.has(t[0]))return!1;for(const t of s.entries())if(!Y(t[1],e.get(t[0])))return!1;return!0}function pt(s,e){if(s.size!==e.size)return!1;for(const t of s.entries())if(!e.has(t[0]))return!1;return!0}function Ue(s){return e=>typeof e===s}const vt=Ue("function"),wt=s=>s===null,_e=s=>Object.prototype.toString.call(s).slice(8,-1)==="RegExp",Ae=s=>!St(s)&&!wt(s)&&(vt(s)||typeof s=="object"),St=Ue("undefined");function Y(s,e){if(s===e)return!0;if(s&&Ae(s)&&e&&Ae(e)){if(s.constructor!==e.constructor)return!1;if(Array.isArray(s)&&Array.isArray(e))return q(s,e);if(s instanceof Map&&e instanceof Map)return yt(s,e);if(s instanceof Set&&e instanceof Set)return pt(s,e);if(ArrayBuffer.isView(s)&&ArrayBuffer.isView(e))return gt(s,e);if(_e(s)&&_e(e))return s.source===e.source&&s.flags===e.flags;if(s.valueOf!==Object.prototype.valueOf)return s.valueOf()===e.valueOf();if(s.toString!==Object.prototype.toString)return s.toString()===e.toString();const t=Object.keys(s),i=Object.keys(e);if(t.length!==i.length)return!1;for(let a=t.length;a--!==0;)if(!Object.prototype.hasOwnProperty.call(e,t[a]))return!1;for(let a=t.length;a--!==0;){const r=t[a];if(!Y(s[r],e[r]))return!1}return!0}return Number.isNaN(s)&&Number.isNaN(e)?!0:s===e}class ie{#t=d(y(!1),"UseBoolean.#current");constructor(e=!1){c(this.#t,e,!0)}toggle(){c(this.#t,!u(this.#t))}setTrue(){c(this.#t,!0)}setFalse(){c(this.#t,!1)}get current(){return u(this.#t)}set current(e){c(this.#t,e,!0)}}class ye{#t=d(y(0),"UseNumber.#current");constructor(e=0){c(this.#t,e,!0)}get current(){return u(this.#t)}set current(e){c(this.#t,e,!0)}}const Kt=U(_(new ie(!1)),"newAccountDialog"),Ht=U(_(new ye(0)),"managingAccountId"),Gt=U(_(new ie(!1)),"newScheduleDialog"),Qt=U(_(new ye(0)),"managingScheduleId");U(_(new ie(!1)),"editAccountDialog");const Jt=U(_(new ie(!1)),"deleteAccountDialog"),Zt=U(_(new ye(0)),"deleteAccountId");let ce;function N(s){const e=typeof window<"u";if(e&&ce)return ce;const t=st({});return e&&(ce=t),t}const Te=Symbol("accounts");class Le{#t=d(y(_(new k)),"AccountsState.accounts");get accounts(){return u(this.#t)}set accounts(e){c(this.#t,e,!0)}#e=d(y("name"),"AccountsState.sortField");get sortField(){return u(this.#e)}set sortField(e){c(this.#e,e,!0)}#s=d(y("asc"),"AccountsState.sortDirection");get sortDirection(){return u(this.#s)}set sortDirection(e){c(this.#s,e,!0)}constructor(e){this.loadSortPreferences(),e&&this.init(e)}init(e){this.accounts.clear(),e.forEach(t=>this.accounts.set(t.id,t))}static get(){return L(Te)}static set(e){return z(Te,new Le(e))}get all(){return this.accounts.values().toArray()}#i=d(A(()=>this.sortAccounts(this.all,this.sortField,this.sortDirection)),"AccountsState.sorted");get sorted(){return u(this.#i)}set sorted(e){c(this.#i,e)}get count(){return this.accounts.size}getById(e){return this.accounts.get(e)}findBy(e){return this.accounts.values().find(e)}filterBy(e){return this.accounts.values().filter(e).toArray()}getByName(e){return this.findBy(t=>l(t.name,e))}getActiveAccounts(){return this.filterBy(e=>!e.closed)}getClosedAccounts(){return this.filterBy(e=>!!e.closed)}getTotalBalance(){return this.all.reduce((e,t)=>e+(t.balance||0),0)}addAccount(e){this.accounts.set(e.id,e)}updateAccount(e){this.accounts.set(e.id,e)}removeAccount(e){const t=this.accounts.get(e);if(t)return this.accounts.delete(e),t}async saveAccount(e){const t={...e,closed:e.closed??void 0},a={...(await g(N().accountRoutes.save.mutate(t)))(),transactions:[],balance:0};return this.addAccount(a),a}async deleteAccount(e){(await g(N().accountRoutes.remove.mutate({id:e})))(),this.removeAccount(e)}async deleteAccounts(e){(await g(Promise.all(e.map(t=>this.deleteAccount(t)))))()}setSorting(e,t){this.sortField=e,this.sortDirection=t,this.saveSortPreferences()}toggleSortDirection(){this.sortDirection=l(this.sortDirection,"asc")?"desc":"asc",this.saveSortPreferences()}loadSortPreferences(){if(l(typeof window,"undefined",!1))try{const e=localStorage.getItem("accounts-sort-preferences");if(e){const{field:t,direction:i}=JSON.parse(e);this.isValidSortField(t)&&this.isValidSortDirection(i)&&(this.sortField=t,this.sortDirection=i)}}catch(e){console.warn(...M("warn","Failed to load sort preferences:",e))}}saveSortPreferences(){if(l(typeof window,"undefined",!1))try{const e={field:this.sortField,direction:this.sortDirection};localStorage.setItem("accounts-sort-preferences",JSON.stringify(e))}catch(e){console.warn(...M("warn","Failed to save sort preferences:",e))}}isValidSortField(e){return["name","balance","dateOpened","status","createdAt"].includes(e)}isValidSortDirection(e){return["asc","desc"].includes(e)}sortAccounts(e,t,i){return[...e].sort((a,r)=>{let n,o;switch(t){case"name":n=a.name?.toLowerCase()||"",o=r.name?.toLowerCase()||"";break;case"balance":n=a.balance||0,o=r.balance||0;break;case"dateOpened":n=a.dateOpened?new Date(a.dateOpened).getTime():0,o=r.dateOpened?new Date(r.dateOpened).getTime():0;break;case"status":n=a.closed?1:0,o=r.closed?1:0;break;case"createdAt":n=a.createdAt?new Date(a.createdAt).getTime():0,o=r.createdAt?new Date(r.createdAt).getTime():0;break;default:n=a.name?.toLowerCase()||"",o=r.name?.toLowerCase()||""}return n<o?l(i,"asc")?-1:1:n>o?l(i,"asc")?1:-1:0})}getSortedActiveAccounts(){return this.sortAccounts(this.getActiveAccounts(),this.sortField,this.sortDirection)}getSortedClosedAccounts(){return this.sortAccounts(this.getClosedAccounts(),this.sortField,this.sortDirection)}has(e){return this.accounts.has(e)}clear(){this.accounts.clear()}}const Ee=Symbol("schedules");class ze{#t=d(y(_(new k)),"SchedulesState.schedules");get schedules(){return u(this.#t)}set schedules(e){c(this.#t,e,!0)}constructor(e){e&&this.init(e)}init(e){this.schedules.clear(),e.forEach(t=>this.schedules.set(t.id,t))}static get(){return L(Ee)}static set(e){return z(Ee,new ze(e))}get all(){return this.schedules.values().toArray()}get count(){return this.schedules.size}getById(e){return this.schedules.get(e)}findBy(e){return this.schedules.values().find(e)}filterBy(e){return this.schedules.values().filter(e).toArray()}getByName(e){return this.findBy(t=>l(t.name,e))}getActiveSchedules(){return this.filterBy(e=>l(e.status,"active"))}getInactiveSchedules(){return this.filterBy(e=>l(e.status,"inactive"))}addSchedule(e){this.schedules.set(e.id,e)}updateSchedule(e){this.schedules.set(e.id,e)}removeSchedule(e){const t=this.schedules.get(e);if(t)return this.schedules.delete(e),t}removeSchedules(e){const t=[];return e.forEach(i=>{const a=this.schedules.get(i);a&&(this.schedules.delete(i),t.push(a))}),t}async saveSchedule(e){const t=(await g(N().scheduleRoutes.save.mutate(e)))();return this.addSchedule(t),t}async deleteSchedule(e){(await g(N().scheduleRoutes.remove.mutate({id:e})))(),this.removeSchedule(e)}async deleteSchedules(e){(await g(Promise.all(e.map(t=>this.deleteSchedule(t)))))()}has(e){return this.schedules.has(e)}clear(){this.schedules.clear()}}const H=j("categories",{id:v("id").primaryKey({autoIncrement:!0}),parentId:v("parent_id").references(()=>H.id),name:f("name"),notes:f("notes"),dateCreated:f("date_created").notNull().default(T`CURRENT_TIMESTAMP`),createdAt:f("created_at").notNull().default(T`CURRENT_TIMESTAMP`),updatedAt:f("updated_at").notNull().default(T`CURRENT_TIMESTAMP`),deletedAt:f("deleted_at")},s=>[p("category_name_idx").on(s.name),p("category_parent_idx").on(s.parentId),p("category_deleted_at_idx").on(s.deletedAt)]);W(H);F(H);F(H,{name:s=>s.transform(e=>e?.trim()).pipe(S().min(1,"Category name is required").max(50,"Category name must be less than 50 characters").refine(e=>!(C.contains(e,"<")||C.contains(e,">")||C.contains(e,"{")||C.contains(e,"}")||C.contains(e,"[")||C.contains(e,"]")||C.contains(e,"\\")||C.contains(e,"|")),"Category name contains invalid characters")),notes:s=>s.transform(e=>e?.trim()).pipe(S().max(500,"Notes must be less than 500 characters").refine(e=>e?!(C.contains(e,"<")||C.contains(e,">")):!0,"Notes cannot contain HTML tags")).optional().nullable()});x({id:I().nonnegative()});x({entities:O(I().nonnegative())});const G=j("payee",{id:v("id").primaryKey({autoIncrement:!0}),name:f("name"),notes:f("notes"),dateCreated:f("date_created").notNull().default(T`CURRENT_TIMESTAMP`),createdAt:f("created_at").notNull().default(T`CURRENT_TIMESTAMP`),updatedAt:f("updated_at").notNull().default(T`CURRENT_TIMESTAMP`),deletedAt:f("deleted_at")},s=>[p("payee_name_idx").on(s.name),p("payee_deleted_at_idx").on(s.deletedAt)]);W(G);F(G);F(G,{name:s=>s.min(1,"Payee name is required").max(50,"Payee name must be less than 50 characters").regex(/^[a-zA-Z0-9\s\-_&']+$/,"Payee name contains invalid characters"),notes:s=>s.max(500,"Notes must be less than 500 characters").optional().nullable()});x({id:I().nonnegative()});x({entities:O(I().nonnegative())});const ae=j("schedule_dates",{id:v("id").primaryKey({autoIncrement:!0}),start:f("start_date").notNull().default(T`CURRENT_TIMESTAMP`),end:f("end_date"),frequency:f("frequency",{enum:["daily","weekly","monthly","yearly"]}),interval:v("interval").default(1),limit:v("limit").default(0),move_weekends:f("move_weekends",{enum:["none","next_weekday","previous_weekday"]}).default("none"),move_holidays:f("move_holidays",{enum:["none","next_weekday","previous_weekday"]}).default("none"),specific_dates:f("specific_dates",{mode:"json"}).default({}),scheduleId:v("schedule_id").notNull().references(()=>Q.id)},s=>[p("relations_schedule_date_schedule_idx").on(s.scheduleId)]);W(ae);F(ae);F(ae,{});x({id:I().nonnegative()});const Q=j("schedules",{id:v("id").primaryKey({autoIncrement:!0}),name:f("name").notNull(),slug:f("slug").notNull(),status:f("status",{enum:["active","inactive"]}).default("active"),amount:fe("amount").default(0).notNull(),amount_2:fe("amount_2").default(0).notNull(),amount_type:f("amount_type",{enum:["exact","approximate","range"]}).default("exact").notNull(),recurring:v("recurring",{mode:"boolean"}).default(!1),auto_add:v({mode:"boolean"}).default(!1),dateId:v("schedule_date_id").references(()=>ae.id),payeeId:v("payee_id").notNull().references(()=>G.id),accountId:v("account_id").notNull().references(()=>J.id),createdAt:f("created_at").notNull().default(T`CURRENT_TIMESTAMP`),updatedAt:f("updated_at").notNull().default(T`CURRENT_TIMESTAMP`)},s=>[p("relations_schedule_schedule_date_idx").on(s.dateId),p("relations_schedule_account_idx").on(s.accountId),p("relations_schedule_payee_idx").on(s.payeeId),p("schedule_status_idx").on(s.status),p("schedule_name_idx").on(s.name),p("schedule_slug_idx").on(s.slug)]);W(Q);F(Q);F(Q,{name:s=>s.min(2).max(30)});x({id:I().nonnegative()});const re=j("transaction",{id:v("id").primaryKey().notNull(),accountId:v("account_id").references(()=>J.id,{onDelete:"cascade"}).notNull(),parentId:v("parent_id").references(()=>re.id),status:f("status",{enum:["cleared","pending","scheduled"]}).default("pending"),payeeId:v("payee_id").references(()=>G.id),amount:fe("amount").default(0).notNull(),categoryId:v("category_id").references(()=>H.id),notes:f("notes"),date:f("date").notNull().default(T`CURRENT_TIMESTAMP`),scheduleId:v("schedule_id").references(()=>Q.id),createdAt:f("created_at").notNull().default(T`CURRENT_TIMESTAMP`),updatedAt:f("updated_at").notNull().default(T`CURRENT_TIMESTAMP`),deletedAt:f("deleted_at")},s=>[p("relations_transaction_account_idx").on(s.accountId),p("relations_transaction_payee_idx").on(s.payeeId),p("relations_transaction_category_idx").on(s.categoryId),p("relations_transaction_schedule_idx").on(s.scheduleId),p("transaction_account_date_idx").on(s.accountId,s.date,s.id),p("transaction_date_idx").on(s.date),p("transaction_status_idx").on(s.status),p("transaction_parent_idx").on(s.parentId),p("transaction_deleted_at_idx").on(s.deletedAt)]);W(re);F(re);F(re,{amount:I({message:"Amount must be a number"}).min(-999999.99,"Amount cannot be less than -$999,999.99").max(999999.99,"Amount cannot exceed $999,999.99").multipleOf(.01,"Amount must be a valid currency value"),notes:s=>s.max(500,"Notes must be less than 500 characters").refine(e=>e?!(C.contains(e,"<")||C.contains(e,">")):!0,"Notes cannot contain HTML tags").optional().nullable(),status:s=>s.refine(e=>!e||["cleared","pending","scheduled"].includes(e),{message:"Invalid transaction status"}).optional()});x({entities:O(I().nonnegative()).max(100,"Too many transactions selected for deletion"),accountId:I().positive("Account ID must be positive")});var bt=(s=>(s.CLEARED="cleared",s.PENDING="pending",s.SCHEDULED="scheduled",s))(bt||{});const J=j("account",{id:v("id").primaryKey({autoIncrement:!0}),cuid:f("cuid").$defaultFn(()=>it.createId()),name:f("name").notNull(),slug:f("slug").notNull(),closed:v("closed",{mode:"boolean"}).default(!1),notes:f("notes"),dateOpened:f("date_opened").notNull().default(T`CURRENT_TIMESTAMP`),createdAt:f("created_at").notNull().default(T`CURRENT_TIMESTAMP`),updatedAt:f("updated_at").notNull().default(T`CURRENT_TIMESTAMP`),deletedAt:f("deleted_at")},s=>[p("account_name_idx").on(s.name),p("account_slug_idx").on(s.slug),p("account_closed_idx").on(s.closed),p("account_deleted_at_idx").on(s.deletedAt)]);W(J);F(J);const _t=F(J,{name:s=>s.transform(e=>e?.trim()).pipe(S().min(1,"Account name is required").min(2,"Account name must be at least 2 characters").max(50,"Account name must be less than 50 characters").regex(/^[a-zA-Z0-9\s\-_.'&()]+$/,"Account name contains invalid characters")),slug:s=>s.transform(e=>e?.trim()?.toLowerCase()).pipe(S().min(2,"Slug must be at least 2 characters").max(30,"Slug must be less than 30 characters").regex(/^[a-z0-9-]+$/,"Slug must contain only lowercase letters, numbers, and hyphens")).optional(),notes:s=>s.transform(e=>e?.trim()).pipe(S().max(500,"Notes must be less than 500 characters")).optional().nullable()}),At=x({id:I().positive(),name:S().transform(s=>s?.trim()).pipe(S().min(2,"Account name must be at least 2 characters").max(50,"Account name must be less than 50 characters").regex(/^[a-zA-Z0-9\s\-_.'&()]+$/,"Account name contains invalid characters")).optional(),slug:S().transform(s=>s?.trim()?.toLowerCase()).pipe(S().min(2,"Slug must be at least 2 characters").max(30,"Slug must be less than 30 characters").regex(/^[a-z0-9-]+$/,"Slug must contain only lowercase letters, numbers, and hyphens")).optional(),notes:S().transform(s=>s?.trim()).pipe(S().max(500,"Notes must be less than 500 characters")).optional().nullable(),closed:te().optional()});Oe([_t,At]);x({id:I().nonnegative()});const je=j("views",{id:v("id").primaryKey({autoIncrement:!0}),name:f("name").notNull(),description:f("description"),icon:f("icon"),filters:f("filters",{mode:"json"}).$type(),display:f("display",{mode:"json"}).$type(),dirty:v("dirty",{mode:"boolean"})});W(je);F(je,{name:S().min(2,"Name must contain at least 2 characters"),description:Oe([S().max(500,"Description must be less than 500 characters"),ue()]).optional(),filters:ee(O(x({column:S(),filter:S(),value:O(rt())})).or(ue())),display:ee(x({grouping:ee(O(S())),sort:ee(O(x({desc:te(),id:S()}))),expanded:we(!0).default(!0).or(Se(S(),te())),visibility:we(!0).default(!0).or(Se(S(),te()))}).or(ue()))});x({id:I().nonnegative()});x({entities:O(I().nonnegative())});const xe=Symbol("categories");class We{#t=d(y(_(new k)),"CategoriesState.categories");get categories(){return u(this.#t)}set categories(e){c(this.#t,e,!0)}constructor(e){e&&this.init(e)}init(e){this.categories.clear(),e.forEach(t=>this.categories.set(t.id,t))}static get(){return L(xe)}static set(e){return z(xe,new We(e))}get all(){return this.categories.values().toArray()}get count(){return this.categories.size}getById(e){return this.categories.get(e)}findBy(e){return this.categories.values().find(e)}filterBy(e){return this.categories.values().filter(e).toArray()}getByName(e){return this.findBy(t=>l(t.name,e))}getActiveCategories(){return this.filterBy(e=>!e.deletedAt)}getParentCategories(){return this.filterBy(e=>!e.parentId)}getChildCategories(e){return this.filterBy(t=>l(t.parentId,e))}addCategory(e){this.categories.set(e.id,e)}updateCategory(e){this.categories.set(e.id,e)}removeCategory(e){const t=this.categories.get(e);if(t)return this.categories.delete(e),t}removeCategories(e){const t=[];return e.forEach(i=>{const a=this.categories.get(i);a&&(this.categories.delete(i),t.push(a))}),t}async saveCategory(e){const t=(await g(N().categoriesRoutes.save.mutate(e)))();return this.addCategory(t),t}async deleteCategory(e){(await g(N().categoriesRoutes.delete.mutate({entities:[e]})))(),this.removeCategory(e)}async deleteCategories(e){(await g(N().categoriesRoutes.delete.mutate({entities:e})))(),this.removeCategories(e)}has(e){return this.categories.has(e)}clear(){this.categories.clear()}}const Ne=Symbol("payees");class qe{#t=d(y(_(new k)),"PayeesState.payees");get payees(){return u(this.#t)}set payees(e){c(this.#t,e,!0)}constructor(e){e&&this.init(e)}init(e){this.payees.clear(),e.forEach(t=>this.payees.set(t.id,t))}static get(){return L(Ne)}static set(e){return z(Ne,new qe(e))}get all(){return this.payees.values().toArray()}get count(){return this.payees.size}getById(e){return this.payees.get(e)}findBy(e){return this.payees.values().find(e)}filterBy(e){return this.payees.values().filter(e).toArray()}getByName(e){return this.findBy(t=>l(t.name,e))}getActivePayees(){return this.filterBy(e=>!e.deletedAt)}addPayee(e){this.payees.set(e.id,e)}updatePayee(e){this.payees.set(e.id,e)}removePayee(e){const t=this.payees.get(e);if(t)return this.payees.delete(e),t}removePayees(e){const t=[];return e.forEach(i=>{const a=this.payees.get(i);a&&(this.payees.delete(i),t.push(a))}),t}async savePayee(e){const t=(await g(N().payeeRoutes.save.mutate(e)))();return this.addPayee(t),t}async deletePayee(e){(await g(N().payeeRoutes.delete.mutate({entities:[e]})))(),this.removePayee(e)}async deletePayees(e){(await g(N().payeeRoutes.delete.mutate({entities:e})))(),this.removePayees(e)}has(e){return this.payees.has(e)}clear(){this.payees.clear()}}new K("en-US",{day:"2-digit",month:"2-digit",year:"numeric"});new K("en-US",{month:"long"});new K("en-US",{month:"short",year:"numeric"});const Xt=new K("en-US",{dateStyle:"long"});new K("en-US",{dateStyle:"short"});const Ye={one:"st",two:"nd",few:"rd",other:"th"},Ke=new Intl.PluralRules("en-US",{type:"ordinal"}),De=s=>{const t=`${new Intl.DateTimeFormat("en-US",{month:"short"}).format(s)}.`,i=s.getDate(),a=Ke.select(i),r=`${i}${Ye[a]??"th"}`,n=new Intl.DateTimeFormat("en-US",{year:"numeric"}).format(s);return`${t} ${r}, ${n}`};function Tt(s){const e=s.day,t=Ke.select(e);return`${e}${Ye[t]??"th"}`}class Et{#t=d(y(),"View.view");get view(){return u(this.#t)}set view(e){c(this.#t,e,!0)}initial;#e=d(y(_(new k)),"View.#filterValues");#s=d(A(()=>(u(this.#e),this.view.filters,this.initial?.filters,l(this.view.name,this.initial?.name,!1)||l(this.view.description,this.initial.description,!1)||!q(this.view.display?.grouping||[],this.initial.display?.grouping||[])||!q(this.view.display?.sort||[],this.initial.display?.sort||[])||!Y(this.view.display?.expanded,this.initial.display?.expanded)||!Y(this.view.display?.visibility,this.initial.display?.visibility)||l(u(this.#e).size,this.initial.filters?.length,!1)||!q(u(this.#e).keys().toArray(),this.initial.filters.map(e=>e.column))||!q(u(this.#e).values().toArray().map(e=>e.filter),this.view.filters?.map(e=>e.filter)||[])||u(this.#e).values().some(({column:e,value:t})=>{const i=this.initial?.filters?.find(a=>l(a.column,e))?.value;return!(l(t.size,0)&&l(i?.length||0,0))&&t.isDisjointFrom(new Set(i))}))),"View.dirty");get dirty(){return u(this.#s)}set dirty(e){c(this.#s,e)}get id(){return this.view.id}get name(){return this.view.name}get description(){return this.view.description}constructor(e){this.view=e,this.view.filters=this.view.filters||[],this.view.display=this.view.display||{grouping:[],sort:[],expanded:{},visibility:{}},this.initial=e,c(this.#e,new k(this.view.filters.map(t=>[t.column,Object.assign({},t,{value:new X(t.value||[])})])),!0)}getColumn(e){return u(this.#e).get(e)?.column}getGrouping(){return this.view.display?.grouping||[]}setGrouping(e){return this.view.display.grouping=e,this}getSorting(){return this.view.display?.sort||[]}setSorting(e){return this.view.display.sort=e,this}updateSorter=(e,t)=>{this.view.display=this.view.display||{},this.view.display.sort=this.view.display.sort?.map(i=>l(i.id,e,!1)?i:Object.assign({},i,{desc:t}))||[],this.view.display.sort?.find(i=>l(i.id,e))||(this.view.display.sort=this.view.display.sort?.concat({id:e,desc:!1}))};getExpanded(){return this.view.display?.expanded||{}}setExpanded(e){return this.view.display.expanded=e,this}getVisibility(){return this.view.display?.visibility||{}}setVisibility(e){return this.view.display.visibility=e,this}updateVisibility(e,t){this.view.display=this.view.display||{},this.view.display.visibility=Object.assign({},this.view.display?.visibility||{},{[e]:t})}getFilter(e){return u(this.#e).get(e)}addFilter(e){u(this.#e).has(e.column)&&this.updateFilter(e);const t=Object.assign({},e,{value:new X(e.value)});u(this.#e).set(e.column,t)}updateFilter(e,t=!1){e.column&&u(this.#e).has(e.column)&&u(this.#e).set(e.column,t?e:Object.assign({},u(this.#e).get(e.column),Object.assign({},e,e.value?{value:new X(e.value)}:{})))}removeFilter(e){u(this.#e).delete(e)}getFilterFn(e){return u(this.#e).get(e)?.filter}getFilterValue(e){return u(this.#e).get(e)?.value||new Set}getAllFilteredColumns(){return u(this.#e).keys().toArray()}getAllFilterValues(){return Array.from(u(this.#e).values()).map(e=>Object.assign({},e,{value:Array.from(e.value)}))}getAllFilterValuesSet(){return u(this.#e)}addFilterValue(e,t){if(!u(this.#e).has(e))return;const i=u(this.#e).get(e);i&&i.value.add(t)}removeFilterValue(e,t){if(!u(this.#e).has(e))return;const i=u(this.#e).get(e);i&&i.value.delete(t)}clearFilterValue(e){if(!u(this.#e).has(e))return;const t=u(this.#e).get(e);t&&t.value.clear()}toggleFilterValue(e,t){if(!u(this.#e).has(e))return;const i=u(this.#e).get(e);i&&(i.value.has(t)?i.value.delete(t):i.value.add(t))}reset(){this.initial&&(this.view.name=this.initial.name,this.view.description=this.initial.description,this.view.display=this.initial.display||{},this.view.display.grouping=this.initial.display?.grouping,this.view.display.sort=this.initial.display?.sort,this.view.display.expanded=this.initial.display?.expanded,this.view.display.visibility=this.initial.display?.visibility,this.view.filters=this.initial.filters,this.view.dirty=!1,c(this.#e,new k(this.view.filters.map(e=>[e.column,Object.assign({},e,{value:new X(e.value||[])})])),!0))}async saveView(){this.view.filters=ve(u(this.#e)).values().toArray().map(e=>Object.assign({},e,{value:Array.from(e.value)})),this.initial=ve(this.view),(await g(N().viewsRoutes.save.mutate(this.view)))()}async deleteView(){(await g(N().viewsRoutes.delete.mutate({entities:[this.view.id]})))()}}class xt{#t=d(y(),"CurrentViewState.view");get view(){return u(this.#t)}set view(e){c(this.#t,e,!0)}#e=d(y(),"CurrentViewState.table");get table(){return u(this.#e)}set table(e){c(this.#e,e,!0)}constructor(e,t){return this.view=new Et(e),this.table=t,this}updateTableState(){this.table.setGrouping(this.view.getGrouping()),this.table.setSorting(this.view.getSorting()),this.table.setExpanded(this.view.getExpanded()),this.table.setColumnVisibility(this.view.getVisibility())}resetToInitialState(){this.view.reset(),this.updateTableFilters(),this.updateTableState()}addFilter(e){this.view.addFilter(e)}updateFilter(e,t=!1){if(this.view.updateFilter(e,t),!e.column)return;const i=this.view.getFilter(e.column),a=this.table.getColumn(e.column);a&&(a.columnDef.filterFn=i?.filter,a.setFilterValue(i?.value))}removeFilter(e){this.view.removeFilter(e);const t=this.table.getColumn(e);t&&t.setFilterValue("")}addFilterValue(e,t){this.view.addFilterValue(e,t),this.updateTableFilter(e)}removeFilterValue(e,t){this.view.removeFilterValue(e,t),this.updateTableFilter(e)}clearFilterValue(e){this.view.clearFilterValue(e),this.updateTableFilter(e)}toggleFilterValue(e,t){this.view.toggleFilterValue(e,t),this.updateTableFilter(e)}updateTableFilter(e){this.table.getColumn(e)?.setFilterValue(this.view.getFilterValue(e))}clearTableFilters(){this.table.setColumnFilters([])}updateTableFilters(){this.clearTableFilters(),this.table.getVisibleFlatColumns().filter(e=>e.getCanFilter()).forEach(e=>{const t=this.view.getFilterFn(e.id);t&&(e.columnDef.filterFn=t),this.view.getFilterValue(e.id).size>0&&e.setFilterValue(this.view.getFilterValue(e.id))})}updateTableGrouping(e){this.view.setGrouping(e),this.table.setGrouping(e)}updateTableAllRowsExpanded(e){this.view.setExpanded(e),this.table.setExpanded(e)}updateTableSorting(e){this.view.setSorting(e),this.table.setSorting(e)}updateTableSorter=(e,t)=>{this.view.updateSorter(e,t),this.table.setSorting(this.view.getSorting())};updateTableVisibility(e){this.view.setVisibility(e),this.table.setColumnVisibility(e)}updateColumnVisibility(e,t){this.view.updateVisibility(e,t),this.table.setColumnVisibility(this.view.getVisibility())}toggleColumnVisibility(e){this.updateColumnVisibility(e,this.view.getVisibility()[e])}}class es{viewsStates=new k;#t=d(y(),"CurrentViewsState.activeViewId");get activeViewId(){return u(this.#t)}set activeViewId(e){c(this.#t,e,!0)}#e=d(A(()=>this.viewsStates.get(this.activeViewId)),"CurrentViewsState.activeView");get activeView(){return u(this.#e)}set activeView(e){c(this.#e,e)}#s=d(y(),"CurrentViewsState.previousViewId");get previousViewId(){return u(this.#s)}set previousViewId(e){c(this.#s,e,!0)}#i=d(A(()=>this.viewsStates.values().filter(e=>e.view.id>0).toArray()),"CurrentViewsState.editableViews");get editableViews(){return u(this.#i)}set editableViews(e){c(this.#i,e)}#a=d(A(()=>this.viewsStates.values().filter(e=>e.view.id<0).toArray()),"CurrentViewsState.nonEditableViews");get nonEditableViews(){return u(this.#a)}set nonEditableViews(e){c(this.#a,e)}constructor(e){e&&(this.viewsStates=new k(e.map(t=>[t.view.id,t])),this.activeViewId=e[0].view.id)}add(e,t=!0){return this.viewsStates.set(e.view.id,e),t&&(this.activeViewId=e.view.id),this}get(e){return Array.isArray(e)?this.viewsStates.values().filter(t=>e.includes(t.view.id)).toArray():this.viewsStates.values().find(t=>l(t.view.id,e))}remove(e,t=!0){let i;return l(typeof e,"number")?(i=this.viewsStates.get(e),this.viewsStates.delete(e)):(i=e,this.viewsStates.delete(e.view.id)),i?.view.deleteView(),t&&this.setActive(this.viewsStates.values().next().value),this}setActive(e){let t;return l(typeof e,"number")?(this.activeViewId=e,t=this.viewsStates.get(e)):(this.activeViewId=e.view.id,t=e),t.updateTableFilters(),t.updateTableState(),this}addTemporaryView=e=>{this.previousViewId=this.activeView.view.id,this.add(new xt({id:0,name:"",description:"",icon:null,filters:[],display:{},dirty:!0},e)).setActive(0)};removeTemporaryView=()=>{this.remove(0,!1),this.previousViewId&&(this.setActive(this.previousViewId),this.previousViewId=void 0)}}const ts=new at("current_views"),He=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),Ge={format:s=>s?.map(e=>({...e,date:ot(ut(e.date))}))},Ie=Symbol("current_account");class ss{#t=d(y(),"CurrentAccountState.account");get account(){return u(this.#t)}set account(e){c(this.#t,e,!0)}#e=d(A(()=>()=>{const e=this.account?.balance??0;return He.format(isNaN(e)?0:e)}),"CurrentAccountState.balance");get balance(){return u(this.#e)}set balance(e){c(this.#e,e)}#s=d(A(()=>this.account?.transactions),"CurrentAccountState.transactions");get transactions(){return u(this.#s)}set transactions(e){c(this.#s,e)}#i=d(A(()=>Ge.format(this.transactions)??[]),"CurrentAccountState.formatted");get formatted(){return u(this.#i)}set formatted(e){c(this.#i,e)}#a=d(A(()=>this.formatted?.filter(Boolean).map(e=>e.category).filter(e=>l(e,null,!1))||[]),"CurrentAccountState.categories");get categories(){return u(this.#a)}set categories(e){c(this.#a,e)}#r=d(A(()=>this.formatted?.filter(Boolean).map(e=>e.payee).filter(e=>l(e,null,!1))||[]),"CurrentAccountState.payees");get payees(){return u(this.#r)}set payees(e){c(this.#r,e)}constructor(e){return e&&(this.account=e),z(Ie,this),this}static get(){return L(Ie)}get id(){return this.account.id}get name(){return this.account.name}get notes(){return this.account.notes}addTransaction(e){this.account.balance+=e.amount,e.balance=this.account.balance,this.transactions?.push(e)}getTransaction(e){return this.formatted?.find(t=>l(t.id,e))}getRawTransaction(e){const t=this.transactions?.findIndex(i=>l(i.id,e));return[t,this.transactions[t]]}updateTransaction=async(e,t,i)=>{const a={[t]:i};let[r,n]=this.getRawTransaction(e);if(l(t,"amount")){const h=i-n?.amount;this.account.balance+=h,this.account.transactions.filter((m,w)=>w>=r).forEach(m=>{m.balance=(m.balance??0)+h})}const o=Object.assign({},n,a);(await g(N().transactionRoutes.save.mutate(o)))(),this.transactions[r]=o};async deleteTransactions(e,t){(await g(N().transactionRoutes.delete.mutate({entities:e,accountId:this.id})))();const[i,a]=mt(this.transactions??[],r=>e.includes(r.id));this.account.transactions=i,this.account.balance=i.length>0?i.map(r=>r.amount).reduce((r,n)=>r+n):0,t&&t(a)}async deleteTransaction(e){return this.deleteTransactions([e])}}const Fe=Symbol("server_account");class is{#t=d(y(),"ServerAccountState.accountSummary");get accountSummary(){return u(this.#t)}set accountSummary(e){c(this.#t,e,!0)}#e=d(y(_([])),"ServerAccountState.currentTransactions");get currentTransactions(){return u(this.#e)}set currentTransactions(e){c(this.#e,e,!0)}#s=d(y(_({page:0,pageSize:50,totalCount:0,totalPages:0,hasNextPage:!1,hasPreviousPage:!1})),"ServerAccountState.pagination");get pagination(){return u(this.#s)}set pagination(e){c(this.#s,e,!0)}#i=d(y(_({sortBy:"date",sortOrder:"desc"})),"ServerAccountState.filters");get filters(){return u(this.#i)}set filters(e){c(this.#i,e,!0)}#a=d(y(!1),"ServerAccountState.isLoadingSummary");get isLoadingSummary(){return u(this.#a)}set isLoadingSummary(e){c(this.#a,e,!0)}#r=d(y(!1),"ServerAccountState.isLoadingTransactions");get isLoadingTransactions(){return u(this.#r)}set isLoadingTransactions(e){c(this.#r,e,!0)}#n=d(y(!1),"ServerAccountState.isSearching");get isSearching(){return u(this.#n)}set isSearching(e){c(this.#n,e,!0)}#o=d(y(null),"ServerAccountState.summaryError");get summaryError(){return u(this.#o)}set summaryError(e){c(this.#o,e,!0)}#u=d(y(null),"ServerAccountState.transactionsError");get transactionsError(){return u(this.#u)}set transactionsError(e){c(this.#u,e,!0)}#l=d(y(!1),"ServerAccountState.hasServerData");get hasServerData(){return u(this.#l)}set hasServerData(e){c(this.#l,e,!0)}constructor(e){setTimeout(()=>{this.hasServerData||(this.loadAccountSummary(e).catch(console.error),this.loadTransactions(e).catch(console.error))},0)}initializeWithServerData(e,t){this.accountSummary={id:e.id,name:e.name,slug:e.slug,type:e.type,notes:e.notes||void 0,balance:e.balance,transactionCount:e.transactionCount},t?.transactions&&(this.currentTransactions=t.transactions,this.pagination={...this.pagination,...t.pagination}),this.isLoadingSummary=!1,this.isLoadingTransactions=!1,this.hasServerData=!0}#c=d(A(()=>()=>{const e=this.accountSummary?.balance??0;return He.format(isNaN(e)?0:e)}),"ServerAccountState.balance");get balance(){return u(this.#c)}set balance(e){c(this.#c,e)}get formatted(){return this.currentTransactions?.length?Ge.format(this.currentTransactions)??[]:[]}#d=d(A(()=>this.formatted.map(e=>e.category).filter(e=>l(e,null,!1))||[]),"ServerAccountState.categories");get categories(){return u(this.#d)}set categories(e){c(this.#d,e)}#h=d(A(()=>this.formatted.map(e=>e.payee).filter(e=>l(e,null,!1))||[]),"ServerAccountState.payees");get payees(){return u(this.#h)}set payees(e){c(this.#h,e)}async loadAccountSummary(e){this.isLoadingSummary=!0,this.summaryError=null;try{const t=(await g(fetch(`/trpc/serverAccountsRoutes.loadSummary?input=${encodeURIComponent(JSON.stringify({id:e}))}`)))();if(!t.ok)throw new Error(`Failed to load summary: HTTP ${t.status}: ${t.statusText}`);const i=(await g(t.text()))();if(!i.trim())throw new Error("Empty response from server");const a=JSON.parse(i),r=a.result?.data||a;this.accountSummary={id:r.id,name:r.name,slug:r.slug,type:r.type,notes:r.notes||void 0,balance:r.balance,transactionCount:r.transactionCount}}catch(t){this.summaryError=t instanceof Error?t.message:"Failed to load account summary",console.error(...M("error","Failed to load account summary:",t))}finally{this.isLoadingSummary=!1}}async loadTransactions(e,t=!1){this.isLoadingTransactions=!0,this.transactionsError=null,t&&(this.pagination.page=0);try{const i={accountId:e,page:this.pagination.page,pageSize:this.pagination.pageSize,sortBy:this.filters.sortBy,sortOrder:this.filters.sortOrder,...this.filters.searchQuery&&{searchQuery:this.filters.searchQuery},...this.filters.dateFrom&&{dateFrom:this.filters.dateFrom},...this.filters.dateTo&&{dateTo:this.filters.dateTo}},a=(await g(fetch(`/trpc/serverAccountsRoutes.loadTransactions?input=${encodeURIComponent(JSON.stringify(i))}`)))();if(!a.ok)throw new Error(`Failed to load transactions: HTTP ${a.status}: ${a.statusText}`);const r=(await g(a.text()))();if(!r.trim())throw new Error("Empty response from server");const n=JSON.parse(r),o=n.result?.data||n;this.currentTransactions=o.transactions,this.pagination={...this.pagination,...o.pagination}}catch(i){this.transactionsError=i instanceof Error?i.message:"Failed to load transactions",console.error(...M("error","Failed to load transactions:",i))}finally{this.isLoadingTransactions=!1}}searchTimeout;async searchTransactions(e,t){this.searchTimeout&&clearTimeout(this.searchTimeout),this.isSearching=!0,this.searchTimeout=setTimeout(async()=>{this.filters.searchQuery=t||void 0,(await g(this.loadTransactions(e,!0)))(),this.isSearching=!1},300)}async setDateFilter(e,t,i){this.filters.dateFrom=t,this.filters.dateTo=i,(await g(this.loadTransactions(e,!0)))()}async setSorting(e,t,i){const a=["date","amount","notes"],r=["asc","desc"];if(!(!a.includes(t)||!r.includes(i)))try{this.filters.sortBy=t,this.filters.sortOrder=i,(await g(this.loadTransactions(e,!0)))()}catch(n){console.error(...M("error","Sort error",n))}}async nextPage(e){this.pagination.hasNextPage&&(this.pagination.page+=1,(await g(this.loadTransactions(e)))(),this.pagination.hasNextPage&&this.prefetchNextPage(e))}async previousPage(e){this.pagination.hasPreviousPage&&(this.pagination.page-=1,(await g(this.loadTransactions(e)))(),this.pagination.hasPreviousPage&&this.prefetchPreviousPage(e))}async goToPage(e,t){t>=0&&t<this.pagination.totalPages&&(this.pagination.page=t,(await g(this.loadTransactions(e)))())}async setPageSize(e,t){this.pagination.pageSize=t,(await g(this.loadTransactions(e,!0)))()}async refresh(e){(await g(Promise.all([this.loadAccountSummary(e),this.loadTransactions(e,!0)])))()}async prefetchNextPage(e){try{const t=this.pagination.page+1;if(t>=this.pagination.totalPages)return;const i={accountId:e,page:t,pageSize:this.pagination.pageSize,sortBy:this.filters.sortBy,sortOrder:this.filters.sortOrder,...this.filters.searchQuery&&{searchQuery:this.filters.searchQuery},...this.filters.dateFrom&&{dateFrom:this.filters.dateFrom},...this.filters.dateTo&&{dateTo:this.filters.dateTo}};fetch(`/trpc/serverAccountsRoutes.loadTransactions?input=${encodeURIComponent(JSON.stringify(i))}`),console.log("ðŸš€ Prefetching next page:",t+1)}catch(t){console.debug(...M("debug","Prefetch next page failed:",t))}}async prefetchPreviousPage(e){try{const t=this.pagination.page-1;if(t<0)return;const i={accountId:e,page:t,pageSize:this.pagination.pageSize,sortBy:this.filters.sortBy,sortOrder:this.filters.sortOrder,...this.filters.searchQuery&&{searchQuery:this.filters.searchQuery},...this.filters.dateFrom&&{dateFrom:this.filters.dateFrom},...this.filters.dateTo&&{dateTo:this.filters.dateTo}};fetch(`/trpc/serverAccountsRoutes.loadTransactions?input=${encodeURIComponent(JSON.stringify(i))}`),console.log("ðŸš€ Prefetching previous page:",t+1)}catch(t){console.debug(...M("debug","Prefetch previous page failed:",t))}}static get(){return L(Fe)}static set(e){return z(Fe,e)}}const Qe=Array.from({length:31},(s,e)=>{const t=e+1,i=ct(t);return{value:t,label:`${t}${i}`}}),Nt={value:32,label:"last day"},Ce=Array.from({length:7},(s,e)=>{const t=e,i=new Intl.DateTimeFormat("en-US",{weekday:"long"}).format(new Date(1970,0,e+4)).replace(/\w/,a=>a.toUpperCase());return{value:t,label:i}}),Pe=[{value:1,label:"first"},{value:2,label:"second"},{value:3,label:"third"},{value:4,label:"fourth"},{value:5,label:"last"}];Array.from({length:12},(s,e)=>{const t=e+1,i=new Intl.DateTimeFormat("en-US",{month:"long"}).format(new Date(1970,e,1));return{value:t,label:i}});var V=(s=>(s.None="none",s.NextWeekday="next_weekday",s.PreviousWeekday="previous_weekday",s))(V||{}),Dt={};const $e=s=>s,It=s=>s.length>0,Ft=s=>s>0&&Number.isFinite(s),Ct=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),Pt=s=>!isNaN(Date.parse(s))&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(s),$t=s=>Number.isFinite(s)&&Math.abs(s)<Number.MAX_SAFE_INTEGER,Je=s=>Dt[s],Ve=s=>{const e=Je(s);if(e===void 0)throw new Error(`Required environment variable ${String(s)} is not set`);return e};class D{static validateNonEmptyString(e){return typeof e=="string"&&It(e)?e:null}static validatePositiveNumber(e){return typeof e=="number"&&Ft(e)?e:null}static validateEmail(e){return typeof e=="string"&&Ct(e)?e:null}static validateISODateString(e){return typeof e=="string"&&Pt(e)?e:null}static validateCurrencyAmount(e){return typeof e=="number"&&$t(e)?e:null}static validatePageSize(e){const t=this.validatePositiveNumber(e);return t&&t<=100?t:null}static validateObject(e,t){const i={};let a=!0;if(typeof e!="object"||e===null)return{data:{},validation:{isValid:!1,errors:{root:[$e("Input must be an object")]}}};const r=e,n={};for(const[o,h]of Object.entries(t)){if(!h)continue;const m=r[o],w=[];try{const E=h(m);if(E.isValid)n[o]=m;else{const b=Object.values(E.errors).flat();w.push(...b),a=!1}}catch(E){w.push($e(`Validation error: ${E}`)),a=!1}w.length>0&&(i[o]=w)}return{data:n,validation:{isValid:a,errors:i}}}}var R={};class pe{static instance=null;config=null;constructor(){}static getInstance(){return this.instance||(this.instance=new pe),this.instance}initialize(){if(this.config)return this.config;try{const e=Ve("NODE_ENV"),t=Ve("DATABASE_URL"),i=Je("API_BASE_URL")||(e==="development"?"http://localhost:5173":"");if(!i)throw new Error("API_BASE_URL must be set for production");const a=this.parsePositiveNumber(R.API_TIMEOUT,5e3,"API_TIMEOUT"),r=this.parsePositiveNumber(R.API_RETRY_ATTEMPTS,3,"API_RETRY_ATTEMPTS"),n=this.parsePageSize(R.UI_PAGE_SIZE,20,"UI_PAGE_SIZE"),o=this.parsePositiveNumber(R.UI_DEBOUNCE_MS,300,"UI_DEBOUNCE_MS"),h=this.parsePositiveNumber(R.UI_ANIMATION_DURATION,200,"UI_ANIMATION_DURATION"),m=this.parsePositiveNumber(R.CACHE_DEFAULT_TTL,3e5,"CACHE_DEFAULT_TTL"),w=this.parsePositiveNumber(R.CACHE_MAX_SIZE,100,"CACHE_MAX_SIZE"),E=this.parseBoolean(R.CACHE_ENABLED,!0,"CACHE_ENABLED");return this.config={api:{baseUrl:D.validateNonEmptyString(i),timeout:a,retryAttempts:r},ui:{pageSize:n,debounceMs:o,animationDuration:h},cache:{defaultTtl:m,maxSize:w,enabled:E}},this.validateConfig(this.config),this.config}catch(e){throw new Error(`Configuration initialization failed: ${e}`)}}getConfig(){return this.config||this.initialize()}getApiConfig(){return this.getConfig().api}getUIConfig(){return this.getConfig().ui}getCacheConfig(){return this.getConfig().cache}updateConfig(e){this.config||this.initialize(),this.config={...this.config,...e,api:{...this.config.api,...e.api},ui:{...this.config.ui,...e.ui},cache:{...this.config.cache,...e.cache}},this.validateConfig(this.config)}reset(){this.config=null}parsePositiveNumber(e,t,i){if(!e){const n=D.validatePositiveNumber(t);if(!n)throw new Error(`Default value for ${i} is not a positive number`);return n}const a=parseInt(e,10),r=D.validatePositiveNumber(a);if(!r)throw new Error(`Environment variable ${i} must be a positive number, got: ${e}`);return r}parsePageSize(e,t,i){if(!e){const n=D.validatePageSize(t);if(!n)throw new Error(`Default value for ${i} is not a valid page size`);return n}const a=parseInt(e,10),r=D.validatePageSize(a);if(!r)throw new Error(`Environment variable ${i} must be a positive number â‰¤ 100, got: ${e}`);return r}parseBoolean(e,t,i){if(!e)return t;const a=e.toLowerCase();if(a==="true"||a==="1"||a==="yes")return!0;if(a==="false"||a==="0"||a==="no")return!1;throw new Error(`Environment variable ${i} must be a boolean value, got: ${e}`)}validateConfig(e){if(!D.validateNonEmptyString(e.api.baseUrl))throw new Error("API baseUrl must be a non-empty string");if(!D.validatePositiveNumber(e.api.timeout))throw new Error("API timeout must be a positive number");if(!D.validatePositiveNumber(e.api.retryAttempts))throw new Error("API retryAttempts must be a positive number");if(!D.validatePageSize(e.ui.pageSize))throw new Error("UI pageSize must be a positive number â‰¤ 100");if(!D.validatePositiveNumber(e.ui.debounceMs))throw new Error("UI debounceMs must be a positive number");if(!D.validatePositiveNumber(e.ui.animationDuration))throw new Error("UI animationDuration must be a positive number");if(!D.validatePositiveNumber(e.cache.defaultTtl))throw new Error("Cache defaultTtl must be a positive number");if(!D.validatePositiveNumber(e.cache.maxSize))throw new Error("Cache maxSize must be a positive number");if(typeof e.cache.enabled!="boolean")throw new Error("Cache enabled must be a boolean")}}pe.getInstance();const Vt={MAX_SAFETY_LIMIT:50},de=Vt.MAX_SAFETY_LIMIT;function ne(s,e){const{start:t,end:i,limit:a}=e,r=[];let n=0,o=!1;const h=Math.min(a??de,de);for(;n<h;){const m=s();if(!m||i&&m>i)break;if(m.compare(t)>=0&&(r.push(m),!i&&r.length>=h)){o=!0;break}if(n++,n>de*2)break}return{dates:r,truncated:o,totalGenerated:n}}function kt(s,e,t,i){if(t<=0)return[];let a=s;return ne(()=>{const o=a;return a=a.add({days:t}),o},{start:s,end:e,limit:i}).dates}function Rt(s,e,t,i,a){if(t<=0)return[];const r=i.length>0?i:[ge(s,P)];let n=s,o=0,h=!0;return ne(()=>{if(o>=r.length&&(h?h=!1:n=n.add({weeks:t}),o=0),o<r.length){const E=r[o];let b;if(h||o===0){if(b=le(n,E,!0),h&&b.compare(s)>0){const Z=Be(n,"en-us","sun"),$=le(Z,E,!0);$.compare(b)<=0&&(b=$)}}else b=le(n,E,!0);return o++,b}return null},{start:s,end:e,limit:a}).dates}function he(s,e,t,i,a,r,n){if(t<=0)return[];let o=s,h=0,m=0,w=0;const E={start:s,end:e,limit:n},b=i===null?null:Array.isArray(i)?i:[i],Z=()=>{if(b&&b.length>0&&(w>=b.length&&(o=o.add({months:t}),w=0),w<b.length)){const $=b[w];w++;try{return o.set({day:Math.min($,Ot(o))})}catch{return null}}if(a.length>0&&r.length>0){if(h>=a.length&&(o=o.add({months:t}),h=0,m=0),m>=r.length)return h++,m=0,Z();if(h<a.length&&m<r.length){const $=a[h],oe=r[m],Xe=ht(o.year,o.month,$,oe);return m++,Xe}}try{const $=o.set({day:s.day});return o=o.add({months:t}),$}catch{return o=o.add({months:t}),null}};return ne(Z,E).dates.sort(($,oe)=>$.compare(oe))}function Mt(s,e,t,i,a){if(i<=0)return[];let r=s;for(;r<e;)r=ke(r,s,i);return ne(()=>{const h=r;return r=ke(r,s,i),h},{start:e,end:t,limit:a}).dates}function ke(s,e,t){let i=s.add({years:t});try{i=i.set({month:e.month,day:e.day})}catch{i=new se(i.year,e.month,1).add({months:1}).subtract({days:1})}return i}function Ot(s){return s.set({day:1}).add({months:1}).subtract({days:1}).day}const Re={start:B,end:B.add({months:1}),end_type:null,frequency:"daily",interval:1,days:null,weeks:[],weeks_days:[],months:[],limit:0,move_weekends:V.None,move_holidays:V.None,specific_dates:[],on:!1,on_type:"day"};[...Qe];class as{#t=d(y(_(Re)),"RepeatingDateInput.value");get value(){return u(this.#t)}set value(e){c(this.#t,e,!0)}#e=d(y(_(B)),"RepeatingDateInput.placeholder");get placeholder(){return u(this.#e)}set placeholder(e){c(this.#e,e,!0)}#s=d(A(()=>l(this.value.end_type,"until")&&this.value.end?{end:this.value.end,limit:1e3,hasEndDate:!0}:l(this.value.end_type,"limit")&&this.value.limit?{end:null,limit:this.value.limit,hasEndDate:!0}:{end:null,limit:this.value.limit||50,hasEndDate:!1}),"RepeatingDateInput.dateConstraints");get dateConstraints(){return u(this.#s)}set dateConstraints(e){c(this.#s,e)}#i=d(A(()=>{const e=this.value.start;if(!e||this.start.month>this.placeholder.month&&l(this.start.year,this.placeholder.year))return null;let t=dt(this.start,this.placeholder)?this.start:this.placeholder;const i=this.placeholder.set({day:1}),a=Be(i,"en-us","sun"),r=this.placeholder.set({day:0}).add({months:1}),n=lt(r,"en-us","sun");return{start:this.start.compare(a)<0&&t.compare(a)>0?a:t,end:n,originalStart:e}}),"RepeatingDateInput.calendarBounds");get calendarBounds(){return u(this.#i)}set calendarBounds(e){c(this.#i,e)}#a=d(A(()=>{const e=this.calendarBounds;if(!e)return[];const t=this.dateConstraints,i=this.value.frequency||"daily",a=this.value.interval||1;try{const r=this.generateDatesForFrequency(i,e,t,a),n=this.value.specific_dates||[];r.push(...n);const o=this.applyWeekendAdjustments(r);return this.sortAndDeduplicateDates(o)}catch(r){return console.warn(...M("warn","Error generating upcoming dates:",r)),[]}}),"RepeatingDateInput.upcoming");get upcoming(){return u(this.#a)}set upcoming(e){c(this.#a,e)}#r=d(A(()=>this.generateFormattedString()),"RepeatingDateInput.formatted");get formatted(){return u(this.#r)}set formatted(e){c(this.#r,e)}generateDatesForFrequency(e,t,i,a){const r={calendarStart:t.start,calendarEnd:i.end,effectiveLimit:i.limit};switch(e){case"daily":return this.generateDailyDates(r,a,t);case"weekly":return this.generateWeeklyDates(r,a,t);case"monthly":return this.generateMonthlyDates(r,a,t);case"yearly":return this.generateYearlyDates(r,a,t);default:return[]}}generateDailyDates(e,t,i){const a=i.start,r=e.calendarEnd||i.end;return kt(a,r,t,e.effectiveLimit)}generateWeeklyDates(e,t,i){const a=this.value.week_days??[];let r=i.start;const n=e.calendarEnd||i.end;return a.length>0&&(r=r<i.originalStart?i.originalStart:r),Rt(r,n,t,a,e.effectiveLimit)}generateMonthlyDates(e,t,i){const a=i.originalStart<i.start?i.originalStart:i.start,r=e.calendarEnd||i.end,n=this.value.on&&l(this.value.on_type,"day")&&this.value.days&&this.value.days>0,o=this.value.on&&l(this.value.on_type,"the")&&this.value.weeks?.length&&this.value.weeks_days?.length;return n?he(a,r,t,this.value.days??null,[],[],e.effectiveLimit):o?he(a,r,t,null,this.value.weeks||[],this.value.weeks_days||[],e.effectiveLimit):he(a,r,t,i.originalStart.day,[],[],e.effectiveLimit)}generateYearlyDates(e,t,i){const a=i.start,r=e.calendarEnd||i.end;return Mt(i.originalStart,a,r,t,e.effectiveLimit)}isWeekend(e){const t=e.toDate(P).getDay();return l(t,0)||l(t,6)}adjustForWeekend(e){if(!this.isWeekend(e)||l(this.value.move_weekends,V.None))return e;const t=e.toDate(P).getDay();if(l(this.value.move_weekends,V.NextWeekday)){if(l(t,0))return e.add({days:1});if(l(t,6))return e.add({days:2})}else if(l(this.value.move_weekends,V.PreviousWeekday)){if(l(t,0))return e.subtract({days:2});if(l(t,6))return e.subtract({days:1})}return e}applyWeekendAdjustments(e){return e.map(t=>this.adjustForWeekend(t))}sortAndDeduplicateDates(e){const t=new Map;for(const i of e){const a=i.toString();t.has(a)||t.set(a,i)}return Array.from(t.values()).sort((i,a)=>i.compare(a))}generateFormattedString(){const{frequency:e,interval:t=1,start:i=B,week_days:a,weeks:r,weeks_days:n,days:o}=this.value;if(!i)return"";const h=new Intl.ListFormat("en-US",{style:"long",type:"conjunction"}),m=this.generateSuffix(),w=De(i.toDate(P));switch(e){case"daily":return this.formatDailyString(t,w,m);case"weekly":return this.formatWeeklyString(t,a,h,w,m);case"monthly":return this.formatMonthlyString(t,o??null,r,n,h,i,w,m);case"yearly":return this.formatYearlyString(t,w,m);default:return""}}generateSuffix(){const e=[];return l(this.value.end_type,"limit")&&e.push(`for ${this.value.limit} times`),l(this.value.end_type,"until")&&this.value.end&&e.push(`until ${De(this.value.end.toDate(P))}`),l(this.value.move_weekends,V.NextWeekday)?e.push("(weekends moved to Monday)"):l(this.value.move_weekends,V.PreviousWeekday)&&e.push("(weekends moved to Friday)"),e.join(" ")}formatDailyString(e,t,i){return`${l(e,1)?"Repeats daily":`Repeats every ${e} day${e>1?"s":""}`} starting from ${t} ${i}`.trim()}formatWeeklyString(e,t,i,a,r){const n=l(e,1)?"Repeats weekly":`Repeats every ${e} week${e>1?"s":""}`,o=t?.length?` on ${i.format(t.map(h=>Ce[h]?.label??""))}`:"";return`${n}${o} starting from ${a} ${r}`.trim()}formatMonthlyString(e,t,i,a,r,n,o,h){const m=l(e,1)?"Repeats monthly":`Repeats every ${e} month${e>1?"s":""}`;if(this.value.on&&l(this.value.on_type,"day")&&t)return`${m} on the ${Qe[t-1]?.label??""} day starting from ${o} ${h}`.trim();if(this.value.on&&l(this.value.on_type,"the")&&i?.length&&a?.length){const w=l(i.length,1)?Pe[i[0]-1]?.label??"":r.format(i.map(b=>Pe[b-1]?.label??"")),E=r.format((a||[]).map(b=>Ce[b]?.label??""));return`${m} on the ${w} ${E} starting from ${o} ${h}`.trim()}return`${m} on the ${Tt(n)} starting from ${o} ${h}`.trim()}formatYearlyString(e,t,i){return`${l(e,1)?"Repeats yearly":`Repeats every ${e} year${e>1?"s":""}`} starting from ${t} ${i}`.trim()}reset(){this.value=structuredClone(Re),this.placeholder=B}validate(){const e=[];return this.value.start||e.push("Start date is required"),(!this.value.interval||this.value.interval<=0)&&e.push("Interval must be greater than 0"),l(this.value.end_type,"until")&&!this.value.end&&e.push("End date is required when using 'until' option"),l(this.value.end_type,"limit")&&(l(this.value.limit,void 0)||l(this.value.limit,null)||this.value.limit<=0)&&e.push("Limit must be greater than 0 when using limit option"),this.value.end&&this.value.start&&this.value.end.compare(this.value.start)<=0&&e.push("End date must be after start date"),{valid:l(e.length,0),errors:e}}set on(e){this.value.on=e}set on_type(e){this.value.on_type=e}set week_days(e){this.value.week_days=e}set weeks(e){this.value.weeks=e}set weeks_days(e){this.value.weeks_days=e}set days(e){this.value.days=e}set interval(e){this.value.interval=Math.max(1,e)}set frequency(e){this.value.frequency=e}set start(e){this.value.start=e}set end(e){this.value.end=l(e,null)?void 0:e}set end_type(e){this.value.end_type=e}set limit(e){this.value.limit=Math.max(0,e)}set specific_dates(e){this.value.specific_dates=e}set months(e){this.value.months=e}set moveWeekends(e){this.value.move_weekends=e}set moveHolidays(e){this.value.move_holidays=e}get start(){return this.value.start??B}get end(){return this.value.end??B.add({months:1})}get end_type(){return this.value.end_type}get frequency(){return this.value.frequency??"daily"}get interval(){return this.value.interval??1}get week_days(){return this.value.week_days??[]}get weeks(){return this.value.weeks??[]}get weeks_days(){return this.value.weeks_days??[]}get days(){return this.value.days??null}get months(){return this.value.months??[]}get limit(){return this.value.limit??0}get moveWeekends(){return this.value.move_weekends??V.None}get moveHolidays(){return this.value.move_holidays??V.None}get specific_dates(){return this.value.specific_dates??[]}get on(){return this.value.on??!1}get on_type(){return this.value.on_type??"day"}}const Me=Symbol("date_filters");class Ze{#t=d(y(_([])),"DateFiltersState.dateFilters");get dateFilters(){return u(this.#t)}set dateFilters(e){c(this.#t,e,!0)}constructor(e){e&&this.init(e)}init(e){this.dateFilters=[...e]}static get(){return L(Me)}static set(e){return z(Me,new Ze(e))}get all(){return[...this.dateFilters]}get count(){return this.dateFilters.length}getByValue(e){return this.dateFilters.find(t=>l(t.value,e))}getByLabel(e){return this.dateFilters.find(t=>l(t.label,e))}findBy(e){return this.dateFilters.find(e)}filterBy(e){return this.dateFilters.filter(e)}add(e){this.dateFilters.some(i=>l(i.value,e.value))||this.dateFilters.push(e)}removeByValue(e){const t=this.dateFilters.findIndex(i=>l(i.value,e));if(l(t,-1,!1))return this.dateFilters.splice(t,1)[0]}remove(e){return this.removeByValue(e.value)}update(e){const t=this.dateFilters.findIndex(i=>l(i.value,e.value));return l(t,-1,!1)?(this.dateFilters[t]=e,!0):(this.add(e),!1)}getRecentFilters(){return this.filterBy(e=>e.value.includes("day")||e.value.includes("week"))}getMonthlyFilters(){return this.filterBy(e=>e.value.includes("month"))}getYearlyFilters(){return this.filterBy(e=>e.value.includes("year"))}sortByRecency(){this.dateFilters.sort((e,t)=>{const i=h=>h.includes("day")?1:h.includes("week")?2:h.includes("month")?3:h.includes("year")?4:5,a=i(e.value),r=i(t.value);if(l(a,r,!1))return a-r;const n=parseInt(e.value.match(/\d+/)?.[0]||"0"),o=parseInt(t.value.match(/\d+/)?.[0]||"0");return n-o})}has(e){return this.dateFilters.some(t=>l(t.value,e))}clear(){this.dateFilters=[]}}export{Le as A,es as C,Ze as D,qe as P,as as R,ze as S,bt as T,ts as a,He as b,qt as c,Xt as d,Pe as e,Jt as f,Zt as g,Gt as h,Qt as i,B as j,zt as k,xt as l,Ht as m,Kt as n,Wt as o,jt as p,ss as q,We as r,Yt as s,is as t,Ce as w};
