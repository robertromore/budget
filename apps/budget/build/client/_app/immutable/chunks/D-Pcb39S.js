import{aY as ct,cp as Se,aj as Ne,cq as $e,cr as le,cs as Y,ct as Dt,cu as de,cv as Ie,cw as Lt,cx as je,cy as Xe,cz as Vt,cA as Qe,am as $t,cB as Ut}from"./CglMtoSz.js";import"./KFa1jneB.js";const Bt="modulepreload",qt=function(n,i){return new URL(n,i).href},et={},En=function(i,s,t){let u=Promise.resolve();if(s&&s.length>0){let a=function(w){return Promise.all(w.map(y=>Promise.resolve(y).then(T=>({status:"fulfilled",value:T}),T=>({status:"rejected",reason:T}))))};const l=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),d=p?.nonce||p?.getAttribute("nonce");u=a(s.map(w=>{if(w=qt(w,t),w in et)return;et[w]=!0;const y=w.endsWith(".css"),T=y?'[rel="stylesheet"]':"";if(t)for(let _=l.length-1;_>=0;_--){const B=l[_];if(B.href===w&&(!y||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${w}"]${T}`))return;const F=document.createElement("link");if(F.rel=y?"stylesheet":Bt,y||(F.as="script"),F.crossOrigin="",F.href=w,d&&F.setAttribute("nonce",d),document.head.appendChild(F),y)return new Promise((_,B)=>{F.addEventListener("load",_),F.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${w}`)))})}))}function f(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return u.then(a=>{for(const l of a||[])l.status==="rejected"&&f(l.reason);return i().catch(f)})};function me(n){const i={}.toString.call(n).slice(8,-1);if(i=="Set")return new Set([...n].map(s=>me(s)));if(i=="Map")return new Map([...n].map(s=>[me(s[0]),me(s[1])]));if(i=="Date")return new Date(n.getTime());if(i=="RegExp")return RegExp(n.source,n.flags);if(i=="Array"||i=="Object"){const s=i=="Object"?Object.create(Object.getPrototypeOf(n)):[];for(const t in n)s[t]=me(n[t]);return s}return n}function Re(n,i,s){return n[i]=s,"skip"}function Ht(n,i){return i.value!==void 0&&typeof i.value!="object"&&i.path.length<n.length}function Q(n,i,s={}){s.modifier||(s.modifier=u=>Ht(i,u)?void 0:u.value);const t=J(n,i,s.modifier);if(t)return s.value===void 0||s.value(t.value)?t:void 0}function J(n,i,s){if(!i.length)return;const t=[i[0]];let u=n;for(;u&&t.length<i.length;){const a=t[t.length-1],l=s?s({parent:u,key:String(a),value:u[a],path:t.map(p=>String(p)),isLeaf:!1,set:p=>Re(u,a,p)}):u[a];if(l===void 0)return;u=l,t.push(i[t.length])}if(!u)return;const f=i[i.length-1];return{parent:u,key:String(f),value:u[f],path:i.map(a=>String(a)),isLeaf:!0,set:a=>Re(u,f,a)}}function K(n,i,s=[]){for(const t in n){const u=n[t],f=u===null||typeof u!="object",a={parent:n,key:t,value:u,path:s.concat([t]),isLeaf:f,set:p=>Re(n,t,p)},l=i(a);if(l==="abort")return l;if(l==="skip")continue;if(!f){const p=K(u,i,a.path);if(p==="abort")return p}}}function zt(n,i){return n===i||n.size===i.size&&[...n].every(s=>i.has(s))}function tt(n,i){const s=new Map;function t(l,p){return l instanceof Date&&p instanceof Date&&l.getTime()!==p.getTime()||l instanceof Set&&p instanceof Set&&!zt(l,p)||l instanceof File&&p instanceof File&&l!==p}function u(l){return l instanceof Date||l instanceof Set||l instanceof File}function f(l,p){const d=p?J(p,l.path):void 0;function w(){return s.set(l.path.join(" "),l.path),"skip"}if(u(l.value)&&(!u(d?.value)||t(l.value,d.value)))return w();l.isLeaf&&(!d||l.value!==d.value)&&w()}K(n,l=>f(l,i)),K(i,l=>f(l,n));const a=Array.from(s.values());return a.sort((l,p)=>l.length-p.length),a}function W(n,i,s){const t=typeof s=="function";for(const u of i){const f=J(n,u,({parent:a,key:l,value:p})=>((p===void 0||typeof p!="object")&&(a[l]={}),a[l]));f&&(f.parent[f.key]=t?s(u,f):s)}}function ce(n){return n.toString().split(/[[\].]+/).filter(i=>i)}function pe(n){return n.reduce((i,s)=>{const t=String(s);return typeof s=="number"||/^\d+$/.test(t)?i+=`[${t}]`:i?i+=`.${t}`:i+=t,i},"")}class I extends Error{constructor(i){super(i),Object.setPrototypeOf(this,I.prototype)}}function Yt(n,i){const s={};function t(u){if("_errors"in s||(s._errors=[]),!Array.isArray(s._errors))if(typeof s._errors=="string")s._errors=[s._errors];else throw new I("Form-level error was not an array.");s._errors.push(u.message)}for(const u of n){if(!u.path||u.path.length==1&&!u.path[0]){t(u);continue}const a=!/^\d$/.test(String(u.path[u.path.length-1]))&&Q(i,u.path.filter(w=>/\D/.test(String(w))))?.value,l=J(s,u.path,({value:w,parent:y,key:T})=>(w===void 0&&(y[T]={}),y[T]));if(!l){t(u);continue}const{parent:p,key:d}=l;a?(d in p||(p[d]={}),"_errors"in p[d]?p[d]._errors.push(u.message):p[d]._errors=[u.message]):d in p?p[d].push(u.message):p[d]=[u.message]}return s}function nt(n,i,s){return s?n:(K(i,t=>{Array.isArray(t.value)&&t.set(void 0)}),K(n,t=>{!Array.isArray(t.value)&&t.value!==void 0||W(i,[t.path],t.value)}),i)}function Gt(n){return ft(n,[])}function ft(n,i){return Object.entries(n).filter(([,t])=>t!==void 0).flatMap(([t,u])=>{if(Array.isArray(u)&&u.length>0){const f=i.concat([t]);return{path:pe(f),messages:u}}else return ft(n[t],i.concat([t]))})}function U(n){return n&&typeof n=="object"?me(n):n}function rt(n){!n.flashMessage||!ct||De(n)&&(document.cookie=`flash=; Max-Age=0; Path=${n.flashMessage.cookiePath??"/"};`)}function De(n){return!n.flashMessage||!ct?!1:n.syncFlashMessage}const lt="noCustomValidity";async function it(n,i){"setCustomValidity"in n&&n.setCustomValidity(""),!(lt in n.dataset)&&dt(n,i)}function Wt(n,i){for(const s of n.querySelectorAll("input,select,textarea,button")){if("dataset"in s&&lt in s.dataset||!s.name)continue;const t=J(i,ce(s.name)),u=t&&typeof t.value=="object"&&"_errors"in t.value?t.value._errors:t?.value;if(dt(s,u),u)return}}function dt(n,i){if(!("setCustomValidity"in n))return;const s=i&&i.length?i.join(`
`):"";n.setCustomValidity(s),s&&n.reportValidity()}const Jt=(n,i=0)=>{const s=n.getBoundingClientRect();return s.top>=i&&s.left>=0&&s.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&s.right<=(window.innerWidth||document.documentElement.clientWidth)},Zt=(n,i=1.125,s="smooth")=>{const f=n.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*i);window.scrollTo({left:0,top:f,behavior:s})},Kt=["checkbox","radio","range","file"];function st(n){const i=!!n&&(n instanceof HTMLSelectElement||n instanceof HTMLInputElement&&Kt.includes(n.type)),s=!!n&&n instanceof HTMLSelectElement&&n.multiple,t=!!n&&n instanceof HTMLInputElement&&n.type=="file";return{immediate:i,multiple:s,file:t}}var D;(function(n){n[n.Idle=0]="Idle",n[n.Submitting=1]="Submitting",n[n.Delayed=2]="Delayed",n[n.Timeout=3]="Timeout"})(D||(D={}));const Xt=new Set;function Qt(n,i,s){let t=D.Idle,u,f;const a=Xt;function l(){p(),w(t!=D.Delayed?D.Submitting:D.Delayed),u=window.setTimeout(()=>{u&&t==D.Submitting&&w(D.Delayed)},s.delayMs),f=window.setTimeout(()=>{f&&t==D.Delayed&&w(D.Timeout)},s.timeoutMs),a.add(p)}function p(){clearTimeout(u),clearTimeout(f),u=f=0,a.delete(p),w(D.Idle)}function d(){a.forEach(g=>g()),a.clear()}function w(g){t=g,i.submitting.set(t>=D.Submitting),i.delayed.set(t>=D.Delayed),i.timeout.set(t>=D.Timeout)}const y=n;function T(g){const j=g.target;s.selectErrorText&&j.select()}function F(){s.selectErrorText&&y.querySelectorAll("input").forEach(g=>{g.addEventListener("invalid",T)})}function _(){s.selectErrorText&&y.querySelectorAll("input").forEach(g=>g.removeEventListener("invalid",T))}const B=n;{F();const g=j=>{j.clearAll?d():p(),j.cancelled||setTimeout(()=>Le(B,s),1)};return Se(()=>{_(),g({cancelled:!0})}),{submitting(){l()},completed:g,scrollToFirstError(){setTimeout(()=>Le(B,s),1)},isSubmitting:()=>t===D.Submitting||t===D.Delayed}}}const Le=async(n,i)=>{if(i.scrollToError=="off")return;const s=i.errorSelector;if(!s)return;await Ne();let t;if(t=n.querySelector(s),!t)return;t=t.querySelector(s)??t;const u=i.stickyNavbar?document.querySelector(i.stickyNavbar):null;typeof i.scrollToError!="string"?t.scrollIntoView(i.scrollToError):Jt(t,u?.offsetHeight??0)||Zt(t,void 0,i.scrollToError);function f(l){return typeof i.autoFocusOnError=="boolean"?i.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(l)}if(!f(navigator.userAgent))return;let a;if(a=t,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(a.tagName)||(a=a.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),a)try{a.focus({preventScroll:!0}),i.selectErrorText&&a.tagName=="INPUT"&&a.select()}catch{}};class Ce extends Error{constructor(i,s){super(i),this.name="DevalueError",this.path=s.join("")}}function at(n){return Object(n)!==n}const en=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function tn(n){const i=Object.getPrototypeOf(n);return i===Object.prototype||i===null||Object.getOwnPropertyNames(i).sort().join("\0")===en}function nn(n){return Object.prototype.toString.call(n).slice(8,-1)}function rn(n){switch(n){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return n<" "?`\\u${n.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function ue(n){let i="",s=0;const t=n.length;for(let u=0;u<t;u+=1){const f=n[u],a=rn(f);a&&(i+=n.slice(s,u)+a,s=u+1)}return`"${s===0?n:i+n.slice(s)}"`}function sn(n){return Object.getOwnPropertySymbols(n).filter(i=>Object.getOwnPropertyDescriptor(n,i).enumerable)}const an=/^[a-zA-Z_$][a-zA-Z_$0-9]*$/;function ot(n){return an.test(n)?"."+n:"["+JSON.stringify(n)+"]"}function ut(n){const i=new DataView(n);let s="";for(let t=0;t<n.byteLength;t++)s+=String.fromCharCode(i.getUint8(t));return un(s)}const on="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function un(n){let i="";for(let s=0;s<n.length;s+=3){const t=[void 0,void 0,void 0,void 0];t[0]=n.charCodeAt(s)>>2,t[1]=(n.charCodeAt(s)&3)<<4,n.length>s+1&&(t[1]|=n.charCodeAt(s+1)>>4,t[2]=(n.charCodeAt(s+1)&15)<<2),n.length>s+2&&(t[2]|=n.charCodeAt(s+2)>>6,t[3]=n.charCodeAt(s+2)&63);for(let u=0;u<t.length;u++)typeof t[u]>"u"?i+="=":i+=on[t[u]]}return i}const mt=-1,cn=-2,fn=-3,ln=-4,dn=-5,pt=-6;function mn(n,i){const s=[],t=new Map,u=[];if(i)for(const d of Object.getOwnPropertyNames(i))u.push({key:d,fn:i[d]});const f=[];let a=0;function l(d){if(typeof d=="function")throw new Ce("Cannot stringify a function",f);if(t.has(d))return t.get(d);if(d===void 0)return mt;if(Number.isNaN(d))return fn;if(d===1/0)return ln;if(d===-1/0)return dn;if(d===0&&1/d<0)return pt;const w=a++;t.set(d,w);for(const{key:T,fn:F}of u){const _=F(d);if(_)return s[w]=`["${T}",${l(_)}]`,w}let y="";if(at(d))y=xe(d);else{const T=nn(d);switch(T){case"Number":case"String":case"Boolean":y=`["Object",${xe(d)}]`;break;case"BigInt":y=`["BigInt",${d}]`;break;case"Date":y=`["Date","${!isNaN(d.getDate())?d.toISOString():""}"]`;break;case"RegExp":const{source:_,flags:B}=d;y=B?`["RegExp",${ue(_)},"${B}"]`:`["RegExp",${ue(_)}]`;break;case"Array":y="[";for(let g=0;g<d.length;g+=1)g>0&&(y+=","),g in d?(f.push(`[${g}]`),y+=l(d[g]),f.pop()):y+=cn;y+="]";break;case"Set":y='["Set"';for(const g of d)y+=`,${l(g)}`;y+="]";break;case"Map":y='["Map"';for(const[g,j]of d)f.push(`.get(${at(g)?xe(g):"..."})`),y+=`,${l(g)},${l(j)}`,f.pop();y+="]";break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const j=ut(d.buffer);y='["'+T+'","'+j+'"]';break}case"ArrayBuffer":{y=`["ArrayBuffer","${ut(d)}"]`;break}default:if(!tn(d))throw new Ce("Cannot stringify arbitrary non-POJOs",f);if(sn(d).length>0)throw new Ce("Cannot stringify POJOs with symbolic keys",f);if(Object.getPrototypeOf(d)===null){y='["null"';for(const g in d)f.push(ot(g)),y+=`,${ue(g)},${l(d[g])}`,f.pop();y+="]"}else{y="{";let g=!1;for(const j in d)g&&(y+=","),g=!0,f.push(ot(j)),y+=`${ue(j)}:${l(d[j])}`,f.pop();y+="}"}}}return s[w]=y,w}const p=l(n);return p<0?`${p}`:`[${s.join(",")}]`}function xe(n){const i=typeof n;return i==="string"?ue(n):n instanceof String?ue(n.toString()):n===void 0?mt.toString():n===0&&1/n<0?pt.toString():i==="bigint"?`["BigInt","${n}"]`:String(n)}function Ae(n,i,s){const t=J(n,i,({parent:u,key:f,value:a})=>(a===void 0&&(u[f]=/\D/.test(f)?{}:[]),u[f]));if(t){const u=s(t.value);t.parent[t.key]=u}return n}function pn(n,i,s){const t=n.form,u=ce(i),f=$e(t,a=>J(a,u)?.value);return{subscribe(...a){const l=f.subscribe(...a);return()=>l()},update(a,l){t.update(p=>Ae(p,u,a),l??s)},set(a,l){t.update(p=>Ae(p,u,()=>a),l??s)}}}function yn(n,i){const s="form"in n;if(!s&&i?.taint!==void 0)throw new I("If options.taint is set, the whole superForm object must be used as a proxy.");return s}function we(n,i,s){const t=ce(i);if(yn(n,s))return pn(n,i,s);const u=$e(n,f=>J(f,t)?.value);return{subscribe(...f){const a=u.subscribe(...f);return()=>a()},update(f){n.update(a=>Ae(a,t,f))},set(f){n.update(a=>Ae(a,t,()=>f))}}}function Ve(n){let i={};const s=Array.isArray(n);for(const[t,u]of Object.entries(n))!u||typeof u!="object"||(s?i={...i,...Ve(u)}:i[t]=Ve(u));return i}const Ee=new WeakMap,ae=new WeakMap,yt=n=>{throw n.result.error},hn={applyAction:!0,invalidateAll:!0,resetForm:!0,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:!1,onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:yt,dataType:"form",validators:void 0,customValidity:!1,clearOnSubmit:"message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",SPA:void 0,validationMethod:"auto"};function gn(n){return`Duplicate form id's found: "${n}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set the warnings.duplicateId option to false in superForm to disable this warning. More information: https://superforms.rocks/concepts/multiple-forms`}let ht=!1;try{SUPERFORMS_LEGACY&&(ht=!0)}catch{}let oe=!1;try{globalThis.STORIES&&(oe=!0)}catch{}function Sn(n,i){let s,t=i??{},u;{if((t.legacy??ht)&&(t.resetForm===void 0&&(t.resetForm=!1),t.taintedMessage===void 0&&(t.taintedMessage=!0)),oe&&t.applyAction===void 0&&(t.applyAction=!1),typeof t.SPA=="string"&&(t.invalidateAll===void 0&&(t.invalidateAll=!1),t.applyAction===void 0&&(t.applyAction=!1)),u=t.validators,t={...hn,...t},(t.SPA===!0||typeof t.SPA=="object")&&t.validators===void 0&&console.warn("No validators set for superForm in SPA mode. Add a validation adapter to the validators option, or set it to false to disable this warning."),!n)throw new I("No form data sent to superForm. Make sure the output from superValidate is used (usually data.form) and that it's not null or undefined. Alternatively, an object with default values for the form can also be used, but then constraints won't be available.");d(n)===!1&&(n={id:t.id??Math.random().toString(36).slice(2,10),valid:!1,posted:!1,errors:{},data:n,shape:Ve(n)}),n=n;const e=n.id=t.id??n.id,r=le(de)??(oe?{}:void 0);if(t.warnings?.duplicateId!==!1)if(!Ee.has(r))Ee.set(r,new Set([e]));else{const o=Ee.get(r);o?.has(e)?console.warn(gn(e)):o?.add(e)}if(ae.has(n)||ae.set(n,n),s=ae.get(n),n=U(s),Se(()=>{Pt(),At(),Ct();for(const o of Object.values(L))o.length=0;Ee.get(r)?.delete(e)}),t.dataType!=="json"){const o=(c,m)=>{if(!(!m||typeof m!="object")){if(Array.isArray(m))m.length>0&&o(c,m[0]);else if(!(m instanceof Date)&&!(m instanceof File)&&!(m instanceof FileList))throw new I(`Object found in form field "${c}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}};for(const[c,m]of Object.entries(n.data))o(c,m)}}const f={formId:n.id,form:U(n.data),constraints:n.constraints??{},posted:n.posted,errors:U(n.errors),message:U(n.message),tainted:void 0,valid:n.valid,submitting:!1,shape:n.shape},a=f,l=Y(t.id??n.id);function p(e){return Object.values(e).filter(o=>d(o)!==!1)}function d(e){return!e||typeof e!="object"||!("valid"in e&&"errors"in e&&typeof e.valid=="boolean")?!1:"id"in e&&typeof e.id=="string"?e.id:!1}const w=Y(n.data),y={subscribe:w.subscribe,set:(e,r={})=>{const o=U(e);return Ge(o,r.taint??!0),w.set(o)},update:(e,r={})=>w.update(o=>{const c=e(o);return Ge(c,r.taint??!0),c})};function T(){return t.SPA===!0||typeof t.SPA=="object"}function F(e){return e>400?e:(typeof t.SPA=="boolean"||typeof t.SPA=="string"?void 0:t.SPA?.failStatus)||e}async function _(e={}){const r=e.formData??a.form;let o={},c;const m=e.adapter??t.validators;if(typeof m=="object"){if(m!=u&&!("jsonSchema"in m))throw new I('Client validation adapter found in options.validators. A full adapter must be used when changing validators dynamically, for example "zod" instead of "zodClient".');if(c=await m.validate(r),!c.success)o=Yt(c.issues,m.shape??a.shape??{});else if(e.recheckValidData!==!1)return _({...e,recheckValidData:!1})}else c={success:!0,data:{}};const v={...a.form,...r,...c.success?c.data:{}};return{valid:c.success,posted:!1,errors:o,data:v,constraints:a.constraints,message:void 0,id:a.formId,shape:a.shape}}function B(e){if(!t.onChange||!e.paths.length||e.type=="blur")return;let r;const o=e.paths.map(pe);e.type&&e.paths.length==1&&e.formElement&&e.target instanceof Element?r={path:o[0],paths:o,formElement:e.formElement,target:e.target,set(c,m,v){we({form:y},c,v).set(m)},get(c){return le(we(y,c))}}:r={paths:o,target:void 0,set(c,m,v){we({form:y},c,v).set(m)},get(c){return le(we(y,c))}},t.onChange(r)}async function g(e,r=!1,o){e&&(t.validators=="clear"&&q.update(v=>(W(v,e.paths,void 0),v)),setTimeout(()=>B(e)));let c=!1;if(r||(t.validationMethod=="onsubmit"||t.validationMethod=="submit-only"||t.validationMethod=="onblur"&&e?.type=="input"||t.validationMethod=="oninput"&&e?.type=="blur")&&(c=!0),c||!e||!t.validators||t.validators=="clear"){if(e?.paths){const v=e?.formElement??fe();v&&j(v)}return}const m=await _({adapter:o});return m.valid&&(e.immediate||e.type!="input")&&y.set(m.data,{taint:"ignore"}),await Ne(),gt(m.errors,e,r),m}function j(e){const r=new Map;if(t.customValidity&&e)for(const o of e.querySelectorAll("[name]")){if(typeof o.name!="string"||!o.name.length)continue;const c="validationMessage"in o?String(o.validationMessage):"";r.set(o.name,{el:o,message:c}),it(o,void 0)}return r}async function gt(e,r,o){const{type:c,immediate:m,multiple:v,paths:V}=r,X=a.errors,ee={};let P=new Map;const k=r.formElement??fe();k&&(P=j(k)),K(e,A=>{if(!Array.isArray(A.value))return;const O=[...A.path];O[O.length-1]=="_errors"&&O.pop();const se=O.join(".");function $(){if(W(ee,[A.path],A.value),t.customValidity&&te&&P.has(se)){const{el:z,message:ne}=P.get(se);ne!=A.value&&(setTimeout(()=>it(z,A.value)),P.clear())}}if(o)return $();const be=A.path[A.path.length-1]=="_errors",te=A.value&&V.some(z=>be?O&&z&&O.length>0&&O[0]==z[0]:se==z.join("."));if(te&&t.validationMethod=="oninput"||m&&!v&&te)return $();if(v){const z=Q(le(q),A.path.slice(0,-1));if(z?.value&&typeof z?.value=="object"){for(const ne of Object.values(z.value))if(Array.isArray(ne))return $()}}const Z=Q(X,A.path);if(Z&&Z.key in Z.parent)return $();if(be){if(t.validationMethod=="oninput"||c=="blur"&&Ft(pe(A.path.slice(0,-1))))return $()}else if(c=="blur"&&te)return $()}),q.set(ee)}function bt(e,r={}){return r.keepFiles&&K(a.form,o=>{if(!(o.parent instanceof FileList)&&(o.value instanceof File||o.value instanceof FileList)){const c=Q(e,o.path);(!c||!(c.key in c.parent))&&W(e,[o.path],o.value)}}),y.set(e,r)}function ye(e,r){return e&&r&&t.resetForm&&(t.resetForm===!0||t.resetForm())}function vt(e=!0){let r=a.form,o=a.tainted;if(e){const c=Nt(a.form);r=c.data;const m=c.paths;m.length&&(o=U(o)??{},W(o,m,!1))}return{valid:a.valid,posted:a.posted,errors:a.errors,data:r,constraints:a.constraints,message:a.message,id:a.formId,tainted:o,shape:a.shape}}async function Ue(e,r){e.valid&&r&&ye(e.valid,r)?Te({message:e.message,posted:!0}):ge({form:e,untaint:r,keepFiles:!0,pessimisticUpdate:t.invalidateAll=="force"||t.invalidateAll=="pessimistic"}),L.onUpdated.length&&await Ne();for(const o of L.onUpdated)o({form:e})}function Te(e={}){e.newState&&(s.data={...s.data,...e.newState});const r=U(s);r.data={...r.data,...e.data},e.id!==void 0&&(r.id=e.id),ge({form:r,untaint:!0,message:e.message,keepFiles:!1,posted:e.posted,resetted:!0})}async function wt(e){if(e.type=="error")throw new I(`ActionResult of type "${e.type}" cannot be passed to update function.`);if(e.type=="redirect"){ye(!0,!0)&&Te({posted:!0});return}if(typeof e.data!="object")throw new I("Non-object validation data returned from ActionResult.");const r=p(e.data);if(!r.length)throw new I("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const o of r)o.id===a.formId&&await Ue(o,e.status>=200&&e.status<300)}const ie=Y(f.message),_e=Y(f.constraints),Me=Y(f.posted),Be=Y(f.shape),Fe=Y(n.errors),q={subscribe:Fe.subscribe,set(e,r){return Fe.set(nt(e,a.errors,r?.force))},update(e,r){return Fe.update(o=>nt(e(o),a.errors,r?.force))},clear:()=>q.set({})};let C=null;function Et(e){C&&e&&Object.keys(e).length==1&&e.paths?.length&&C.target&&C.target instanceof HTMLInputElement&&C.target.type.toLowerCase()=="file"?C.paths=e.paths:C=e,setTimeout(()=>{g(C)},0)}function St(e,r,o,c,m){C===null&&(C={paths:[]}),C.type=e,C.immediate=r,C.multiple=o,C.formElement=c,C.target=m}function qe(){return C?.paths??[]}function At(){C=null}const x={defaultMessage:"Leave page? Changes that you made may not be saved.",state:Y(),message:t.taintedMessage,clean:U(n.data),forceRedirection:!1};function He(){return t.taintedMessage&&!a.submitting&&!x.forceRedirection&&Ye()}function ze(e){if(!He())return;e.preventDefault(),e.returnValue="";const{taintedMessage:r}=t,c=typeof r=="function"||r===!0?x.defaultMessage:r;return(e||window.event).returnValue=c||x.defaultMessage,c}async function Tt(e){if(!He())return;const{taintedMessage:r}=t,o=typeof r=="function";if(o&&e.cancel(),e.type==="leave")return;const c=o||r===!0?x.defaultMessage:r;let m;try{m=o?await r(e):window.confirm(c||x.defaultMessage)}catch{m=!1}if(m&&e.to)try{x.forceRedirection=!0,await $t(e.to.url,{...e.to.params});return}finally{x.forceRedirection=!1}else!m&&!o&&e.cancel()}function _t(){t.taintedMessage=x.message}function Mt(){return x.state}function Ft(e){if(!a.tainted)return!1;if(!e)return!!a.tainted;const r=Q(a.tainted,ce(e));return!!r&&r.key in r.parent}function Ye(e){if(!arguments.length)return he(a.tainted);if(typeof e=="boolean")return e;if(typeof e=="object")return he(e);if(!a.tainted||e===void 0)return!1;const r=Q(a.tainted,ce(e));return he(r?.value)}function he(e){if(!e)return!1;if(typeof e=="object"){for(const r of Object.values(e))if(he(r))return!0}return e===!0}function Ge(e,r){if(r=="ignore")return;const o=tt(e,a.form),c=tt(e,x.clean).map(m=>m.join());o.length&&(x.state.update(m=>(m||(m={}),W(m,o,(v,V)=>{if(!c.includes(v.join()))return;const X=J(e,v),ee=J(x.clean,v);return X&&ee&&X.value===ee.value?void 0:r===!0?!0:r==="untaint"?void 0:V.value}),m)),Et({paths:o})),(r=="untaint-all"||r=="untaint-form")&&x.state.set(void 0)}function kt(e,r){x.state.set(e),r&&(x.clean=r)}const ke=Y(!1),We=Y(!1),Je=Y(!1),Ze=[x.state.subscribe(e=>f.tainted=U(e)),y.subscribe(e=>f.form=U(e)),q.subscribe(e=>f.errors=U(e)),l.subscribe(e=>f.formId=e),_e.subscribe(e=>f.constraints=e),Me.subscribe(e=>f.posted=e),ie.subscribe(e=>f.message=e),ke.subscribe(e=>f.submitting=e),Be.subscribe(e=>f.shape=e)];function Ot(e){Ze.push(e)}function Pt(){Ze.forEach(e=>e())}let H;function fe(){return H}function It(e){H=document.createElement("form"),H.method="POST",H.action=e,Ke(H),document.body.appendChild(H)}function jt(e){H&&(H.action=e)}function Ct(){H?.parentElement&&H.remove(),H=void 0}const xt=$e(q,e=>e?Gt(e):[]);t.taintedMessage=void 0;function ge(e){const r=e.form,o=e.message??r.message;if((e.untaint||e.resetted)&&kt(typeof e.untaint=="boolean"?void 0:e.untaint,r.data),e.pessimisticUpdate||bt(r.data,{taint:"ignore",keepFiles:e.keepFiles}),ie.set(o),e.resetted?q.update(()=>({}),{force:!0}):q.set(r.errors),l.set(r.id),Me.set(e.posted??r.posted),r.constraints&&_e.set(r.constraints),r.shape&&Be.set(r.shape),f.valid=r.valid,t.flashMessage&&De(t)){const c=t.flashMessage.module.getFlash(de);o&&le(c)===void 0&&c.set(o)}}const L={onSubmit:t.onSubmit?[t.onSubmit]:[],onResult:t.onResult?[t.onResult]:[],onUpdate:t.onUpdate?[t.onUpdate]:[],onUpdated:t.onUpdated?[t.onUpdated]:[],onError:t.onError?[t.onError]:[]};window.addEventListener("beforeunload",ze),Se(()=>{window.removeEventListener("beforeunload",ze)}),Dt(Tt),Ot(de.subscribe(async e=>{oe&&e===void 0&&(e={status:200});const r=e.status>=200&&e.status<300;if(t.applyAction&&e.form&&typeof e.form=="object"){const o=e.form;if(o.type==="error")return;for(const c of p(o)){const m=ae.has(c);c.id!==a.formId||m||(ae.set(c,c),await Ue(c,r))}}else if(t.applyAction!=="never"&&e.data&&typeof e.data=="object")for(const o of p(e.data)){const c=ae.has(o);if(o.id!==a.formId||c)continue;(t.invalidateAll==="force"||t.invalidateAll==="pessimistic")&&(s.data=o.data);const m=ye(o.valid,!0);ge({form:o,untaint:r,keepFiles:!m,resetted:m})}})),typeof t.SPA=="string"&&It(t.SPA);function Ke(e,r){if(t.SPA!==void 0&&e.method=="get"&&(e.method="post"),typeof t.SPA=="string"?t.SPA.length&&e.action==document.location.href&&(e.action=t.SPA):H=e,r){if(r.onError){if(t.onError==="apply")throw new I('options.onError is set to "apply", cannot add any onError events.');if(r.onError==="apply")throw new I('Cannot add "apply" as onError event in use:enhance.');L.onError.push(r.onError)}r.onResult&&L.onResult.push(r.onResult),r.onSubmit&&L.onSubmit.push(r.onSubmit),r.onUpdate&&L.onUpdate.push(r.onUpdate),r.onUpdated&&L.onUpdated.push(r.onUpdated)}_t();let o;async function c(P){const k=st(P.target);k.immediate&&!k.file&&await new Promise(A=>setTimeout(A,0)),o=qe(),St("input",k.immediate,k.multiple,e,P.target??void 0)}async function m(P){if(a.submitting||!o||qe()!=o)return;const k=st(P.target);k.immediate&&!k.file&&await new Promise(A=>setTimeout(A,0)),o!==void 0&&(g({paths:o,immediate:k.multiple,multiple:k.multiple,type:"blur",formElement:e,target:P.target??void 0}),o=void 0)}e.addEventListener("focusout",m),e.addEventListener("input",c),Se(()=>{e.removeEventListener("focusout",m),e.removeEventListener("input",c)});const v=Qt(e,{submitting:ke,delayed:We,timeout:Je},t);let V,X;const ee=Lt(e,async P=>{let k,A=t.validators;const O={...P,jsonData(b){if(t.dataType!=="json")throw new I("options.dataType must be set to 'json' to use jsonData.");k=b},validators(b){A=b},customRequest(b){X=b}},se=O.cancel;let $=!1;function Oe(b){const h={...b,posted:!0},S=h.valid?200:F(400),M={form:h},N=h.valid?{type:"success",status:S,data:M}:{type:"failure",status:S,data:M};setTimeout(()=>ne({result:N}),0)}function be(){switch(t.clearOnSubmit){case"errors-and-message":q.clear(),ie.set(void 0);break;case"errors":q.clear();break;case"message":ie.set(void 0);break}}async function te(b,h){if(b.status=h,t.onError!=="apply"){const S={result:b,message:ie,form:n};for(const M of L.onError)M!=="apply"&&(M!=yt||!t.flashMessage?.onError)&&await M(S)}t.flashMessage&&t.flashMessage.onError&&await t.flashMessage.onError({result:b,flashMessage:t.flashMessage.module.getFlash(de)}),t.applyAction&&(t.onError=="apply"?await je(b):await je({type:"failure",status:F(b.status),data:b}))}function Z(b={resetTimers:!0}){return $=!0,b.resetTimers&&v.isSubmitting()&&v.completed({cancelled:$}),se()}if(O.cancel=Z,v.isSubmitting()&&t.multipleSubmits=="prevent")Z({resetTimers:!1});else{v.isSubmitting()&&t.multipleSubmits=="abort"&&V&&V.abort(),v.submitting(),V=O.controller;for(const b of L.onSubmit)try{await b(O)}catch(h){Z(),te({type:"error",error:h},500)}}if($&&t.flashMessage&&rt(t),!$){const b=!T()&&(e.noValidate||(O.submitter instanceof HTMLButtonElement||O.submitter instanceof HTMLInputElement)&&O.submitter.formNoValidate);let h;const S=async()=>await _({adapter:A});if(be(),b||(h=await S(),h.valid||(Z({resetTimers:!1}),Oe(h))),!$){t.flashMessage&&(t.clearOnSubmit=="errors-and-message"||t.clearOnSubmit=="message")&&De(t)&&t.flashMessage.module.getFlash(de).set(void 0);const M="formData"in O?O.formData:O.data;if(o=void 0,T())h||(h=await S()),Z({resetTimers:!1}),Oe(h);else if(t.dataType==="json"){h||(h=await S());const N=U(k??h.data);K(N,E=>{if(E.value instanceof File){const R="__superform_file_"+pe(E.path);return M.append(R,E.value),E.set(void 0)}else if(Array.isArray(E.value)&&E.value.length&&E.value.every(R=>R instanceof File)){const R="__superform_files_"+pe(E.path);for(const G of E.value)M.append(R,G);return E.set(void 0)}}),Object.keys(N).forEach(E=>{typeof M.get(E)=="string"&&M.delete(E)});const re=t.transport?Object.fromEntries(Object.entries(t.transport).map(([E,R])=>[E,R.encode])):void 0,ve=z(mn(N,re),t.jsonChunkSize??5e5);for(const E of ve)M.append("__superform_json",E)}if(!M.has("__superform_id")){const N=a.formId;N!==void 0&&M.set("__superform_id",N)}typeof t.SPA=="string"&&jt(t.SPA)}}function z(b,h){const S=Math.ceil(b.length/h),M=new Array(S);for(let N=0,re=0;N<S;++N,re+=h)M[N]=b.substring(re,re+h);return M}async function ne(b){let h=!1;V=null;let S="type"in b.result&&"status"in b.result?b.result:{type:"error",status:F(parseInt(String(b.result.status))||500),error:b.result.error instanceof Error?b.result.error:b.result};const M=()=>h=!0,N={result:S,formEl:e,formElement:e,cancel:M},re=oe||!T()?()=>{}:Xe.subscribe(E=>{!E||E.from?.route.id===E.to?.route.id||M()});function ve(E,R,G){R.result={type:"error",error:E,status:F(G)}}for(const E of L.onResult)try{await E(N)}catch(R){ve(R,N,Math.max(S.status??500,400))}if(S=N.result,!h){if((S.type==="success"||S.type==="failure")&&S.data){const E=p(S.data);if(!E.length)throw new I("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const R of E){if(R.id!==a.formId)continue;const G={form:R,formEl:e,formElement:e,cancel:()=>h=!0,result:S};for(const Pe of L.onUpdate)try{await Pe(G)}catch(Rt){ve(Rt,G,Math.max(S.status??500,400))}S=G.result,h||(t.customValidity&&Wt(e,G.form.errors),ye(G.form.valid,S.type=="success")&&G.formElement.querySelectorAll('input[type="file"]').forEach(Pe=>Pe.value=""))}}h||(S.type!=="error"?(S.type==="success"&&t.invalidateAll&&await Vt(),t.applyAction?await je(S):await wt(S)):await te(S,Math.max(S.status??500,400)))}if(h&&t.flashMessage&&rt(t),h||S.type!="redirect")v.completed({cancelled:h});else if(oe)v.completed({cancelled:h,clearAll:!0});else{const E=Xe.subscribe(R=>{R||(setTimeout(()=>{try{E&&E()}catch{}}),v.isSubmitting()&&v.completed({cancelled:h,clearAll:!0}))})}re()}if(!$&&X){se();const b=await X(P);let h;b instanceof Response?h=Qe(await b.text()):b instanceof XMLHttpRequest?h=Qe(b.responseText):h=b,h.type==="error"&&(h.status=b.status),ne({result:h})}return ne});return{destroy:()=>{for(const[P,k]of Object.entries(L))L[P]=k.filter(A=>A===t[P]);ee.destroy()}}}function Nt(e){const r=[];if(K(e,c=>{if(c.value instanceof File)return r.push(c.path),"skip";if(Array.isArray(c.value)&&c.value.length&&c.value.every(m=>m instanceof File))return r.push(c.path),"skip"}),!r.length)return{data:e,paths:r};const o=U(e);return W(o,r,c=>Q(s.data,c)?.value),{data:o,paths:r}}return{form:y,formId:l,errors:q,message:ie,constraints:_e,tainted:Mt(),submitting:Ie(ke),delayed:Ie(We),timeout:Ie(Je),options:t,capture:vt,restore:e=>{ge({form:e,untaint:e.tainted??!0})},async validate(e,r={}){if(!t.validators)throw new I("options.validators must be set to use the validate method.");r.update===void 0&&(r.update=!0),r.taint===void 0&&(r.taint=!1),typeof r.errors=="string"&&(r.errors=[r.errors]);let o;const c=ce(e);"value"in r?r.update===!0||r.update==="value"?(y.update(V=>(W(V,[c],r.value),V),{taint:r.taint}),o=a.form):(o=U(a.form),W(o,[c],r.value)):o=a.form;const m=await _({formData:o}),v=Q(m.errors,c);return v&&v.value&&r.errors&&(v.value=r.errors),(r.update===!0||r.update=="errors")&&q.update(V=>(W(V,[c],v?.value),V)),v?.value},async validateForm(e={}){if(!t.validators&&!e.schema)throw new I("options.validators or the schema option must be set to use the validateForm method.");const r=e.update?await g({paths:[]},!0,e.schema):_({adapter:e.schema}),o=fe();return e.update&&o&&setTimeout(()=>{o&&Le(o,{...t,scrollToError:e.focusOnError===!1?"off":t.scrollToError})},1),r||_({adapter:e.schema})},allErrors:xt,posted:Me,reset(e){return Te({message:e?.keepMessage?a.message:void 0,data:e?.data,id:e?.id,newState:e?.newState})},submit(e){const r=fe()?fe():e&&e instanceof HTMLElement?e.closest("form"):void 0;if(!r)throw new I("use:enhance must be added to the form to use submit, or pass a HTMLElement inside the form (or the form itself) as an argument.");if(!r.requestSubmit)return r.submit();const o=e&&(e instanceof HTMLButtonElement&&e.type=="submit"||e instanceof HTMLInputElement&&["submit","image"].includes(e.type));r.requestSubmit(o?e:void 0)},isTainted:Ye,enhance:Ke}}let bn=!1;try{SUPERFORMS_LEGACY&&(bn=!0)}catch{}const An=Ut;export{En as _,An as m,Sn as s};
